<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾) | NgIokWeng's Blog</title><meta name="keywords" content="UE4,é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½"><meta name="author" content="NgIokWeng"><meta name="copyright" content="NgIokWeng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½">
<meta property="og:type" content="article">
<meta property="og:title" content="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)">
<meta property="og:url" content="https://ngiokweng.github.io/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/index.html">
<meta property="og:site_name" content="NgIokWeng&#39;s Blog">
<meta property="og:description" content="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://ngiokweng.github.io/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image61.png">
<meta property="article:published_time" content="2025-01-27T09:00:58.000Z">
<meta property="article:modified_time" content="2025-01-27T09:01:30.000Z">
<meta property="article:author" content="NgIokWeng">
<meta property="article:tag" content="Androidé€†å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ngiokweng.github.io/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image61.png"><link rel="shortcut icon" href="/myImg/blogIcon.png"><link rel="canonical" href="https://ngiokweng.github.io/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="google-site-verification" content="iO5LJpaf7bluC9CxlRdPhowI-XL-OzJ-X6ixOkO3cuk"/><meta name="baidu-site-verification" content="code-ZZyU1mBcxX"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'è¤‡è£½æˆåŠŸ',
    error: 'è¤‡è£½éŒ¯èª¤',
    noSupport: 'ç€è¦½å™¨ä¸æ”¯æ´'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'å‰›å‰›',
    min: 'åˆ†é˜å‰',
    hour: 'å°æ™‚å‰',
    day: 'å¤©å‰',
    month: 'å€‹æœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-27 17:01:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/myCustom.css"><meta name="generator" content="Hexo 5.4.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">è¼‰å…¥ä¸­...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/myImg/blogIcon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">51</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">æ¨™ç±¤</div><div class="length-num">20</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">åˆ†é¡</div><div class="length-num">9</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é </span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ™‚é–“è»¸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ¨™ç±¤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†é¡</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹éˆ</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image61.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">NgIokWeng's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é </span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ™‚é–“è»¸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ¨™ç±¤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†é¡</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹éˆ</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">ç™¼è¡¨æ–¼</span><time class="post-meta-date-created" datetime="2025-01-27T09:00:58.000Z" title="ç™¼è¡¨æ–¼ 2025-01-27 17:00:58">2025-01-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°æ–¼</span><time class="post-meta-date-updated" datetime="2025-01-27T09:01:30.000Z" title="æ›´æ–°æ–¼ 2025-01-27 17:01:30">2025-01-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android%E9%80%86%E5%90%91/">Androidé€†å‘</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é–±è®€é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆå°‘æ¥è§¸UE4é€†å‘ï¼Œå€Ÿé€™å€‹æ¯”è³½çš„é¡Œç›®ä¾†å­¸ç¿’ä¸‹UE4é€†å‘å’Œvmè™›æ“¬æ©Ÿã€‚</p>
<p>ä¸»è¦åƒè€ƒé€™å…©ç¯‡æ–‡ç« ä¾†å¾©ç¾ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0">ã€Œ[åŸåˆ›] 2024è…¾è®¯æ¸¸æˆå®‰å…¨å¤§èµ›-å®‰å“èµ›é“å†³èµ›VMåˆ†æä¸è¿˜åŸã€</a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281463.htm">ã€Œ[åŸåˆ›] è…¾è®¯æ¸¸æˆå®‰å…¨æŠ€æœ¯ç«èµ›2024å†³èµ› å®‰å“æ–¹å‘è§£é¢˜æŠ¥å‘Šã€</a></li>
</ul>
<h2 id="Dump-SDK"><a href="#Dump-SDK" class="headerlink" title="Dump SDK"></a>Dump SDK</h2><p>UE4é€†å‘çš„ç¬¬ä¸€æ­¥åŸºæœ¬éƒ½è¦å…ˆDump SDKï¼Œå¦å‰‡æ ¹æœ¬ç„¡å¾ä¸‹æ‰‹ã€‚</p>
<h3 id="UE4ä¸‰ä»¶å¥—"><a href="#UE4ä¸‰ä»¶å¥—" class="headerlink" title="UE4ä¸‰ä»¶å¥—"></a>UE4ä¸‰ä»¶å¥—</h3><p>æŒ‰å¸¸è¦æ–¹æ³•éœæ…‹å®šä½ä¸‰ä»¶å¥—ã€‚</p>
<p>GNameï¼š<code>0x4E2EC00</code></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image.png" alt="image.png"></p>
<p>GWorldï¼š<code>0x4F5C0D0</code></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image1.png" alt="image.png"></p>
<p>GObjectï¼š<code>0x4E533AC</code></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image2.png" alt="image.png"></p>
<p>å˜—è©¦ç”¨ue4dumperä¾†dump sdkï¼Œä½†å¤±æ•—äº†ã€‚å¤±æ•—çš„åŸå› å¾ˆæœ‰å¯èƒ½æ˜¯<code>GWorld</code>çš„çµæ§‹è¢«é­”æ”¹äº†ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image3.png" alt="image.png"></p>
<p>ç”¨fridaé©—è­‰ä¸‹GNmaeå­—ç¬¦ä¸²ç®—æ³•æ˜¯å¦è¢«é­”æ”¹ã€‚</p>
<p>æ ¹æ“šUE4.27æºç¢¼çš„<code>FNmae::ToString()</code>å‡½æ•¸ï¼Œå¯ä»¥å¾—å‡º32ä½ç¨‹åºçš„å­—ç¬¦ä¸²ç®—æ³•å¦‚ä¸‹ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getName32</span>(<span class="params">GName, idx</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = idx;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FNameEntryAllocator</span> = <span class="title class_">GName</span>.<span class="title function_">add</span>(<span class="number">0x28</span>); <span class="comment">// 32ä½çš„FNameEntryAllocatoråç§»ç‚º0x28</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FNameBlockOffsetBits</span> = <span class="number">16</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FNameBlockOffsets</span> = <span class="number">65536</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Block</span> = <span class="title class_">ComparisonIndex</span> &gt;&gt; <span class="title class_">FNameBlockOffsetBits</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Offset</span> = <span class="title class_">ComparisonIndex</span> &amp; (<span class="title class_">FNameBlockOffsets</span> - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Blocks</span>_Offset = <span class="number">0x8</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Blocks</span> = <span class="title class_">FNameEntryAllocator</span>.<span class="title function_">add</span>(<span class="title class_">Blocks</span>_Offset)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FNameEntry</span> = <span class="title class_">Blocks</span>.<span class="title function_">add</span>(<span class="title class_">Block</span> * <span class="title class_">Process</span>.<span class="property">pointerSize</span>).<span class="title function_">readPointer</span>().<span class="title function_">add</span>(<span class="title class_">Offset</span> * <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FNameEntryHeader</span> = <span class="title class_">FNameEntry</span>.<span class="title function_">readU16</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// console.log(&quot;FNameEntry: &quot;, hexdump(FNameEntry));</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> isWide = <span class="title class_">FNameEntryHeader</span> &amp; <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Len</span> = <span class="title class_">FNameEntryHeader</span> &gt;&gt; <span class="number">6</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// console.log(&quot;len: &quot;, Len)</span></span><br><span class="line">    <span class="comment">// console.log(hexdump(FNameEntry))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == isWide) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`\x1b[32m[+] <span class="subst">$&#123;FNameEntry.add(<span class="number">2</span>).readCString(Len)&#125;</span>\x1b[0m`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// base == libUE4.so base</span></span><br><span class="line"><span class="title function_">getName32</span>(base.<span class="title function_">add</span>(<span class="number">0x4E2EC00</span>), <span class="number">0</span>)</span><br><span class="line"><span class="title function_">getName32</span>(base.<span class="title function_">add</span>(<span class="number">0x4E2EC00</span>), <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰“å°å‡ºå‰2å€‹å­—ç¬¦ä¸²å¦‚ä¸‹ï¼Œç¬¦åˆé æœŸï¼Œä»£è¡¨<code>GName</code>åœ°å€æ˜¯æ­£ç¢ºçš„ä¸”å­—ç¬¦ä¸²ç®—æ³•å¤§æ¦‚ç‡æ²’æœ‰è¢«é­”æ”¹ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image4.png" alt="image.png"></p>
<h3 id="çµæ§‹ä¿®å¾©"><a href="#çµæ§‹ä¿®å¾©" class="headerlink" title="çµæ§‹ä¿®å¾©"></a>çµæ§‹ä¿®å¾©</h3><p>é€šéCEè§€å¯Ÿå…§å­˜çš„æ–¹å¼ä¾†ä¿®å¾©çµæ§‹ã€‚</p>
<p>ç¸½çµï¼Œè¦ä¿®æ”¹çš„offsetå¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni\Offsets.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add to: patchCustom_32()</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">isTencentGamematch2024final</span>()) &#123;</span><br><span class="line">    <span class="comment">//Class: UObject</span></span><br><span class="line">    <span class="comment">// UObjectToInternalIndex = 0x8;</span></span><br><span class="line">    UObjectToClassPrivate = <span class="number">0x14</span>;</span><br><span class="line">    UObjectToFNameIndex = <span class="number">0x18</span>;</span><br><span class="line">    UObjectToOuterPrivate = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: UStruct</span></span><br><span class="line">    UStructToSuperStruct = <span class="number">0x40</span>;</span><br><span class="line"></span><br><span class="line">    UStructToChildren = <span class="number">0x6c</span>;</span><br><span class="line">    UStructToChildProperties = <span class="number">0x44</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: UWorld</span></span><br><span class="line">    UWorldToPersistentLevel = <span class="number">0x58</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: ULevel</span></span><br><span class="line">    ULevelToAActors = <span class="number">0x9C</span>;</span><br><span class="line">    ULevelToAActorsCount = <span class="number">0xA0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: UFunction</span></span><br><span class="line">    UFunctionToFunc = <span class="number">0xA4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: UField</span></span><br><span class="line">    UFieldToNext = <span class="number">0x2C</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: FUObjectArray</span></span><br><span class="line">    <span class="comment">// FUObjectArrayToTUObjectArray = 0x10;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Class: TUObjectArray</span></span><br><span class="line">    TUObjectArrayToNumElements = <span class="number">0xC</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Global</span></span><br><span class="line">    FUObjectItemPadd = <span class="number">0x4</span>;</span><br><span class="line">    FUObjectItemSize = <span class="number">0x14</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°ç·¨è­¯ä¿®æ”¹Offsetå¾Œçš„<code>ue4dumper</code>ï¼Œå†æ¬¡å˜—è©¦dump sdkï¼Œé€™æ¬¡æˆåŠŸäº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ue4dumper_ext --sdku --newue+ --gname 0x4E2EC00 --guobj 0x4E533AC --package com.tencent.ace.gamematch2024final</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image5.png" alt="image.png"></p>
<h2 id="åŸºç¤ä¿è­·"><a href="#åŸºç¤ä¿è­·" class="headerlink" title="åŸºç¤ä¿è­·"></a>åŸºç¤ä¿è­·</h2><p>ç°¡å–®çœ‹çœ‹ç¨‹åºçš„ä¸€äº›ä¿è­·ï¼Œè©³ç´°åˆ†æå¯çœ‹ï¼š<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0">https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0</a></p>
<h3 id="hook-svc"><a href="#hook-svc" class="headerlink" title="hook svc"></a>hook svc</h3><p>hook <code>openat</code>ç³»çµ±èª¿ç”¨ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image6.png" alt="image.png"></p>
<p>hook <code>access</code>ç³»çµ±èª¿ç”¨ï¼šæª¢æ¸¬äº†rootã€magiskã€riruã€sandhookã€fridaç­‰</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image7.png" alt="image.png"></p>
<p>é™¤æ­¤ä¹‹å¤–é‚„æœ‰CRCæ ¡é©—ä»£ç¢¼æ®µï¼Œfrida hookæœƒæ”¹è®Šä»£ç¢¼æ®µï¼Œå¾è€Œè¢«æª¢æ¸¬åˆ°ã€‚</p>
<h3 id="bypassæ€è·¯1"><a href="#bypassæ€è·¯1" class="headerlink" title="bypassæ€è·¯1"></a>bypassæ€è·¯1</h3><p>å˜—è©¦hook <code>pthread_create</code>ï¼Œä½†æª¢æ¸¬ä»£ç¢¼è²Œä¼¼ä¸åœ¨é€™ã€‚</p>
<p>æŸ¥äº†æŸ¥UE4çš„å®šæ™‚å™¨ï¼Œç™¼ç¾<code>SetTimer</code>å‡½æ•¸ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetTimer</span></span></span><br><span class="line"><span class="function"><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    FTimerHandle &amp; InOutHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    UserClass * InObj,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">typename</span> FTimerDelegate::TUObjectMethodDelegate_Const&lt; UserClass &gt;::FMethodPtr InTimerMethod,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">float</span> InRate,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">bool</span> InbLoop,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">float</span> InFirstDelay</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨SDKè£¡æœï¼Œçœ‹åˆ°<code>K2_SetTimer</code>ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image8.png" alt="image.png"></p>
<p>æ ¹æ“šå®˜ç¶²å°<code>SetTimer</code>çš„æè¿°ï¼Œhook <code>K2_SetTimer</code>ä¸¦å°‡<code>InRate</code>ç½®ç‚ºè² æ•¸ï¼ŒæˆåŠŸè®“ç¨‹åºåœ¨éä¸€æœƒå¾Œä»ä¸æœƒé–ƒé€€ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image9.png" alt="image.png"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(base.<span class="title function_">add</span>(<span class="number">0x37AD990</span>),&#123;</span><br><span class="line">    <span class="title function_">onEnter</span>(<span class="params">args</span>)&#123;</span><br><span class="line">        args[<span class="number">3</span>] = <span class="title function_">ptr</span>(-<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="bypassæ€è·¯2"><a href="#bypassæ€è·¯2" class="headerlink" title="bypassæ€è·¯2"></a>bypassæ€è·¯2</h3><p>åœ¨SDKè£¡å¯ä»¥çœ‹åˆ°<code>start1</code>ã€<code>start2</code>å‡½æ•¸ï¼Œååˆ†å¯ç–‘ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image10.png" alt="image.png"></p>
<p>å˜—è©¦ç›´æ¥patchæ‰ï¼ŒåŒæ¨£ä¸å†é–ƒé€€ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch_anti</span>(<span class="params">base</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> targetAddress2 = base.<span class="title function_">add</span>(<span class="number">0x223c534</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">replace</span>(targetAddress2, <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;, <span class="string">&#x27;int&#x27;</span>, []));</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">var</span> targetAddress3 = base.<span class="title function_">add</span>(<span class="number">0x223c544</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">replace</span>(targetAddress3, <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;, <span class="string">&#x27;int&#x27;</span>, []));</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆè¦‹ç™»éŒ„é‚è¼¯"><a href="#åˆè¦‹ç™»éŒ„é‚è¼¯" class="headerlink" title="åˆè¦‹ç™»éŒ„é‚è¼¯"></a>åˆè¦‹ç™»éŒ„é‚è¼¯</h2><p>åœ¨Dumpä¸‹ä¾†çš„SDKè£¡æœå°‹ç›¸é—œçš„é—œéµå­—ï¼Œæ‰¾åˆ°<code>CheckPassWordInc</code>ã€‚</p>
<p>ç”¨frida hookè©²å‡½æ•¸çš„ä¸­è½‰åœ°å€<code>0x19f63a4</code>ï¼Œçš„ç¢ºæ¯æ¬¡é»æ“Šç™»éŒ„æŒ‰éˆ•æ™‚éƒ½æœƒè§¸ç™¼ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image11.png" alt="image.png"></p>
<p>å°‡<code>libUE4.so</code>æ‹‰å…¥IDAåˆ†æï¼Œç™¼ç¾å…·é«”çš„checké‚è¼¯åœ¨<code>sub_19F4304</code>è£¡é€²è¡Œï¼Œä¸€é–‹å§‹å…ˆåˆ¤æ–·äº†è¼¸å…¥çš„é•·åº¦æ˜¯å¦ç‚º<code>32</code>ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image12.png" alt="image.png"></p>
<p>ç¹¼çºŒå‘ä¸‹çœ‹ï¼Œç™¼ç¾åªæœ‰<code>sub_46CFDDC</code>é€™å€‹å‡½æ•¸è¢«æ··æ·†å¾—ç‰¹åˆ¥åš´é‡ã€‚</p>
<p>hookçœ‹çœ‹è©²å‡½æ•¸çš„åƒæ•¸ï¼Œ<code>args[0]</code>æ˜¯32å­—ç¯€çš„è¼¸å…¥ï¼Œ<code>args[1]</code>ä¸€é–‹å§‹æ˜¯ç©ºï¼Œåœ¨å‡½æ•¸leaveæ™‚åŒæ¨£ä¿å­˜è‘—32å­—ç¯€çš„æ•¸æ“šï¼Œæ‡‰è©²æ˜¯åŠ å¯†çµæœï¼Œå³è©²å‡½æ•¸å°±æ˜¯å…·é«”çš„åŠ å¯†å‡½æ•¸ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image13.png" alt="image.png"></p>
<p>åŠ å¯†å‡½æ•¸è¢«æ··æ·†æˆé€™æ¨£æ ¹æœ¬ç„¡å¾åˆ†æï¼Œæ¥ä¸‹ä¾†å…ˆç”¨Unicornä¾†è§£æ··æ·†ã€‚</p>
<h2 id="Unicornæ¨¡æ“¬åŸ·è¡Œè§£æ··æ·†"><a href="#Unicornæ¨¡æ“¬åŸ·è¡Œè§£æ··æ·†" class="headerlink" title="Unicornæ¨¡æ“¬åŸ·è¡Œè§£æ··æ·†"></a>Unicornæ¨¡æ“¬åŸ·è¡Œè§£æ··æ·†</h2><p>ä¸»è¦æœ‰ä»¥ä¸‹å…©ç¨®æ··æ·†ï¼Œéƒ½å¯ä»¥ç®—æ˜¯é–“æ¥è·³è½‰ï¼š</p>
<ol>
<li><code>it.cc</code> + <code>mov pc</code>çš„çµ„åˆã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:046D1C60                 CMP             R0, #0</span><br><span class="line">.text:046D1C62                 IT NE</span><br><span class="line">.text:046D1C64                 MOVNE           R1, #8</span><br><span class="line">.text:046D1C66                 LDR             R0, [R4,#0x14]</span><br><span class="line">.text:046D1C68                 MOV             R2, R9</span><br><span class="line">.text:046D1C6A                 ADD             R0, R9</span><br><span class="line">.text:046D1C6C                 LDR             R0, [R0,R1]</span><br><span class="line">.text:046D1C6E                 ADD             R0, R6</span><br><span class="line">.text:046D1C70                 MOV             PC, R0</span><br></pre></td></tr></table></figure>

<p>IDA F5æœƒåƒé€™æ¨£ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image14.png" alt="image.png"></p>
<p>æ³¨ï¼šå¯èƒ½æœƒå­˜åœ¨é€™ç¨®åªæœ‰<code>it.cc</code>æ²’æœ‰<code>mov pc, &lt;reg&gt;</code>çš„ï¼Œè¦æ³¨æ„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:046D2834                 IT CC</span><br><span class="line">.text:046D2836                 MOVCC           R0, #1</span><br><span class="line">.text:046D2838                 STRD.W          R6, R5, [R1,#0x44]</span><br><span class="line">.text:046D283C                 STRD.W          R0, R2, [R1,#0x4C]</span><br><span class="line">.text:046D2840                 POP.W           &#123;R11&#125;</span><br><span class="line">.text:046D2844                 POP             &#123;R4-R7,PC&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>blx &#123;register&#125;</code>é–“æ¥è·³è½‰ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:046CFDF6                 LDRD.W          R1, R0, [R6]</span><br><span class="line">.text:046CFDFA                 LDR             R2, [R6,#(off_4D89E98 - 0x4D89E90)]</span><br><span class="line">.text:046CFDFC                 ADD             R0, R4</span><br><span class="line">.text:046CFDFE                 MOV             R9, R5</span><br><span class="line">.text:046CFE00                 LDR             R1, [R1,R4]</span><br><span class="line">.text:046CFE02                 ADDS            R3, R1, R5</span><br><span class="line">.text:046CFE04                 ADDS            R1, R2, R4</span><br><span class="line">.text:046CFE06                 ADDS            R1, #0x19</span><br><span class="line">.text:046CFE08                 BLX             R3      ; sub_46D2DCC</span><br></pre></td></tr></table></figure>

<p>IDA F5æœƒåƒé€™æ¨£ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image15.png" alt="image.png"></p>
<h3 id="è§£æ··æ·†æ€è·¯"><a href="#è§£æ··æ·†æ€è·¯" class="headerlink" title="è§£æ··æ·†æ€è·¯"></a>è§£æ··æ·†æ€è·¯</h3><p>è§£æ··æ·†çš„æ€è·¯ &amp; è…³æœ¬ä¾†æºæ–¼ï¼š<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281463.htm">https://bbs.kanxue.com/thread-281463.htm</a>ã€‚</p>
<p>ç°¡å–®èªªä¸‹ä¸Šé¢é€™ç¯‡æ–‡ç« çš„è§£æ··æ·†æ€è·¯ã€‚</p>
<p><code>it.cc</code> + <code>mov pc &lt;reg&gt;</code>é€™ç¨®çµ„åˆå¯ä»¥ç›´æ¥è½‰æ›æˆ<code>b.cc &lt;branch1&gt;</code> + <code>b &lt;branch2&gt;</code>é€™å¥—æ¢ä»¶åˆ†æ”¯æŒ‡ä»¤ï¼Œå‰ææ˜¯è¦çŸ¥é“2å€‹åˆ†æ”¯çš„å…·é«”åœ°å€ï¼Œå› æ­¤è§£æ··æ·†çš„ç›®çš„å°±æ˜¯æƒ³è¾¦æ³•ç²å–å…·é«”çš„åˆ†æ”¯åœ°å€ã€‚</p>
<ol>
<li>å…ˆåŸ·è¡Œä¸€æ¬¡ç›®æ¨™å‡½æ•¸ï¼Œç›®çš„æ˜¯ç²å–é€™äº›ä¿¡æ¯ï¼š<code>it.cc</code>æ‰€åœ¨åœ°å€( ä¹Ÿå°±æ˜¯å¾…patchçš„åœ°å€ )ã€<code>it.cc</code>æ‰€åœ¨ä½ç½®çš„context( ç”¨æ–¼ä¹‹å¾Œæ¨¡æ“¬åŸ·è¡Œå¦ä¸€å€‹åˆ†æ”¯ )ã€<code>mov pc &lt;reg&gt;</code>åŸ·è¡Œå¾Œçš„åœ°å€( ç¬¬1å€‹åˆ†æ”¯ )ã€‚</li>
<li>ä»¥BFSçš„æ–¹å¼éæ­·ä¸Šè¿°ç²å–çš„ä¿¡æ¯ï¼Œæ¢å¾©åˆ°<code>it.cc</code>ä½ç½®çš„ç‹€æ…‹ï¼Œç„¶å¾Œä¿®æ”¹CPSRæ¨™èªŒå¯„å­˜å™¨ï¼Œå¾è€ŒåŸ·è¡Œå¦ä¸€æ¢åˆ†æ”¯ã€‚</li>
<li>ä¸æ–·é‡è¤‡ç¬¬2æ­¥ï¼Œç›¡å¯èƒ½è¦†è“‹å¤šä¸€é»è·¯å¾‘ã€‚</li>
</ol>
<p>åœ¨å…¶åŸºç¤ä¸Šæˆ‘æ·»åŠ äº†<code>hook_blx_reg</code>ç”¨ä¾†è™•ç†<code>blx</code>é–“æ¥è·³è½‰ï¼Œå…·é«”é‚è¼¯å’Œä¸Šé¢å·®ä¸å¤šï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hook_blx_reg</span>(<span class="params">emu: Uc, addr, size, user_data</span>):</span><br><span class="line">    <span class="keyword">global</span> do_blx_reg</span><br><span class="line">    <span class="keyword">global</span> prev_blx_addr</span><br><span class="line">    <span class="keyword">global</span> blx_config</span><br><span class="line">    <span class="keyword">global</span> disasm_history_blx</span><br><span class="line">    <span class="keyword">global</span> prev_ins_size</span><br><span class="line">    <span class="keyword">global</span> prev_blx_prev_ins_size</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é™åˆ¶ä¸€ä¸‹, å¦å‰‡æ¯æ¬¡éƒ½disasmæœƒéå¸¸æ…¢</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> do_blx_reg:</span><br><span class="line">        <span class="keyword">if</span> addr <span class="keyword">in</span> disasm_history_blx:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    disasm_history_blx[addr] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    disasm = get_disasm(emu, addr, size)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> disasm:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    offset = addr - libUE4_base</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ¤æ–·æ˜¯å¦ blx reg, æ˜¯å°±ä»£è¡¨é–“æ¥è·³è½‰, è¨˜éŒ„ä¸‹blxçš„åœ°å€</span></span><br><span class="line">    <span class="keyword">if</span> disasm.mnemonic == <span class="string">&quot;blx&quot;</span> <span class="keyword">and</span> disasm.operands[<span class="number">0</span>].reg &gt;= UC_ARM_REG_R0 <span class="keyword">and</span> disasm.operands[<span class="number">0</span>].reg &lt;= UC_ARM_REG_R12:</span><br><span class="line">        do_blx_reg = <span class="literal">True</span></span><br><span class="line">        prev_blx_addr = offset</span><br><span class="line">        <span class="comment"># prev_ins = get_disasm(emu, addr - prev_ins_size, prev_ins_size)</span></span><br><span class="line">        <span class="comment"># print(hex((addr - prev_ins_size - libUE4_base)) + &#x27;\t&#x27; + prev_ins.mnemonic + &#x27;\t&#x27; + prev_ins.op_str + &#x27;\t&#x27; + str(prev_ins_size))</span></span><br><span class="line">        prev_blx_prev_ins_size = prev_ins_size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> do_blx_reg:</span><br><span class="line">        <span class="keyword">if</span> prev_blx_addr <span class="keyword">in</span> blx_config <span class="keyword">and</span> blx_config[prev_blx_addr].blx_addr != offset:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">hex</span>(prev_blx_addr)&#125;</span>: blxæœ‰å¤šå€‹ç›®æ¨™åœ°å€?&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åªæ¥å—libUE4.soè£¡çš„åœ°å€, å…¶ä»–ç³»çµ±å‡½æ•¸çš„åœ°å€ä¸è™•ç†</span></span><br><span class="line">        <span class="keyword">if</span> addr &gt; libUE4_base <span class="keyword">and</span> addr &lt; libUE4_end:</span><br><span class="line">            blx_config[prev_blx_addr] = BlxConfig(prev_blx_addr, offset, prev_blx_prev_ins_size)</span><br><span class="line"></span><br><span class="line">        do_blx_reg = <span class="literal">False</span></span><br><span class="line">        prev_blx_addr = <span class="literal">None</span></span><br><span class="line">        prev_blx_prev_ins_size = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    prev_ins_size = size</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€äº›ä¸è¶³ä¹‹è™•"><a href="#ä¸€äº›ä¸è¶³ä¹‹è™•" class="headerlink" title="ä¸€äº›ä¸è¶³ä¹‹è™•"></a>ä¸€äº›ä¸è¶³ä¹‹è™•</h3><ol>
<li>é‡å°<code>blx</code>é–“æ¥è·³è½‰çš„è§£æ··æ·†ï¼Œæœƒå°è‡´ç¬¬0å€‹åƒæ•¸è¢«è¦†è“‹</li>
</ol>
<p>åŸæœ¬æ˜¯é€™æ¨£çš„ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image16.png" alt="image.png"></p>
<p>è…³æœ¬Patchå¾Œæ˜¯é€™æ¨£çš„ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image17.png" alt="image.png"></p>
<p>å¯ä»¥çœ‹åˆ°<code>mov r0, r10</code>é€™å¥è¢«è¦†è“‹äº†ï¼Œè€Œé€™å¥æ­£æ˜¯<code>get_bit</code>å‡½æ•¸çš„ç¬¬0å€‹åƒæ•¸çš„è³¦å€¼æŒ‡ä»¤ã€‚</p>
<ol>
<li>é‡å°<code>it.cc</code>é–“æ¥è·³è½‰çš„è§£æ··æ·†ï¼Œæœƒå°è‡´ä¸€äº›ä¸Šä¸‹æ–‡ç¼ºå¤±</li>
</ol>
<p>ç´…æ¡†é‚£éƒ¨ä»½ä»£ç¢¼é™¤äº†åœ¨è¨ˆç®—é–“æ¥è·³è½‰çš„åœ°å€å¤–ï¼Œé‚„åŒ…å«ä¸€äº›å¾ŒçºŒéœ€è¦çš„ä¸Šä¸‹æ–‡ï¼Œä½†æœ¬è…³æœ¬çš„patché¸æ“‡ç›´æ¥å¾è—æ¡†é‚£è£¡è·³è½‰ï¼Œå°è‡´ç¼ºå¤±äº†ç´…æ¡†ä¸­çš„ä¸€äº›ä¸Šä¸‹æ–‡ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image18.png" alt="image.png"></p>
<p>æœ€çµ‚æœƒå½±éŸ¿IDA F5çš„åˆ†æï¼šé€™å€‹<code>0x60</code>æ‡‰è©²æ˜¯<code>vm_ctx[b4]</code>æ‰å°ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image19.png" alt="image.png"></p>
<ol>
<li>IDAè·³è½‰åœ°å€è§£æå‡ºéŒ¯</li>
</ol>
<p><code>0x46d0792</code>é€™å€‹åœ°å€çš„æŒ‡ä»¤ç†æ‡‰æ˜¯<code>beq 0x46d0f16</code>æ‰å°ï¼Œä½†IDAè§£ææˆäº†å¦ä¸€å€‹åœ°å€ï¼Œæš«æ™‚ä¸çŸ¥åŸå› ã€‚( å°±ç®—æ‰‹å‹•Keypatchç‚º<code>beq 0x46d0f16</code>ä¹Ÿæ˜¯é¡¯ç¤º<code>beq.w loc_47A16AA+2</code> )</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image20.png" alt="image.png"></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image21.png" alt="image.png"></p>
<p>è§£æ±ºæ–¹æ¡ˆï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> è¨ˆç®—: <span class="number">0x47A16AA</span> + <span class="number">2</span> - <span class="number">0x46d0f16</span> = <span class="number">0xD0796</span></span><br><span class="line"><span class="number">2.</span> <span class="number">0x46d0f16</span> - <span class="number">0xD0796</span> = <span class="number">0x4600780</span></span><br><span class="line"><span class="number">3.</span> æ”¹ç‚º beq <span class="number">0x4600780</span></span><br></pre></td></tr></table></figure>

<p>ç„¶å¾ŒIDAå°±æœƒé¡¯ç¤ºç‚ºé æœŸçš„<code>beq 0x46d0f16</code></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image22.png" alt="image.png"></p>
<aside>
ğŸ’¡

<p>ç¶œä¸Šä¸è¶³ä¹‹è™•ï¼ŒIDAçš„F5å½ä»£ç¢¼åªèƒ½ä½œç‚ºåƒè€ƒï¼Œåˆ†ææ™‚ä¸€å®šè¦çµåˆ( åŸsoçš„ )åŒ¯ç·¨ä¾†ä¸€èµ·çœ‹ã€‚</p>
</aside>

<h2 id="Section0ï¼šç™»éŒ„é‚è¼¯åˆ†æ"><a href="#Section0ï¼šç™»éŒ„é‚è¼¯åˆ†æ" class="headerlink" title="Section0ï¼šç™»éŒ„é‚è¼¯åˆ†æ"></a>Section0ï¼šç™»éŒ„é‚è¼¯åˆ†æ</h2><p>åœ¨è§£æ··æ·†ä»¥åŠå°éƒ¨ä»½å‡½æ•¸æ‰‹å‹•é‡æ–°è§£æå¾Œï¼Œå¯ä»¥åœ¨IDAçš„F5è¦–åœ–è£¡çœ‹åˆ°ç™»éŒ„çš„å¯†æ–‡ç‚ºï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image23.png" alt="image.png"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x3D</span>, <span class="number">0xF2</span>, <span class="number">0x2C</span>, <span class="number">0xF8</span>, <span class="number">0x8F</span>, <span class="number">0xFB</span>, <span class="number">0x47</span>, <span class="number">0x5B</span>, <span class="number">0x49</span>, <span class="number">0x04</span>, <span class="number">0x78</span>, <span class="number">0xD9</span>, <span class="number">0x4E</span>, <span class="number">0x31</span>, <span class="number">0xEF</span>, <span class="number">0x3E</span>, <span class="number">0xA1</span>, <span class="number">0xA7</span>, <span class="number">0xAA</span>, <span class="number">0x7B</span>, <span class="number">0xCF</span>, <span class="number">0x72</span>, <span class="number">0xA8</span>, <span class="number">0xBC</span>, <span class="number">0x53</span>, <span class="number">0x2B</span>, <span class="number">0x67</span>, <span class="number">0x00</span>, <span class="number">0xB2</span>, <span class="number">0xB0</span>, <span class="number">0x32</span>, <span class="number">0xFA</span></span><br></pre></td></tr></table></figure>

<p>è€Œ<code>sub_46CFDDC</code>é€™å€‹è¢«åš´é‡æ··æ·†çš„å‡½æ•¸ï¼Œä¸»è¦åšäº†3ä»¶äº‹ï¼š</p>
<ol>
<li>è§£å¯†opcodesã€‚</li>
<li>èª¿ç”¨<code>vm_init</code>åˆå§‹åŒ–vmè™›æ“¬æ©Ÿã€‚</li>
<li>èª¿ç”¨<code>vm_start</code>å•Ÿå‹•vmè™›æ“¬æ©Ÿï¼Œåœ¨å…¶ä¸­åŸ·è¡ŒåŠ å¯†é‚è¼¯ã€‚</li>
</ol>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image24.png" alt="image.png"></p>
<h3 id="vmåˆå§‹åŒ–"><a href="#vmåˆå§‹åŒ–" class="headerlink" title="vmåˆå§‹åŒ–"></a>vmåˆå§‹åŒ–</h3><p>ä¸€é–‹å§‹å…ˆèª¿ç”¨<code>sub_46D2754</code>ä¾†è§£å¯†opcodesï¼Œç„¶å¾Œåˆå§‹åŒ–<code>vm_ctx</code>ï¼Œå®ƒé¡ä¼¼æ–¼arm32çš„å¯„å­˜å™¨ã€‚</p>
<p>åœ¨<code>vm_ctx</code>åˆå§‹åŒ–å¾Œæ‰“å°çœ‹çœ‹å…¶ä¸­çš„å€¼ï¼Œå¯ä»¥åˆæ­¥ç¢ºå®šä»¥ä¸‹å¹¾å€‹çš„å«ç¾©ï¼š</p>
<ul>
<li><code>vm_ctx[0]</code>ï¼šå­—ç¬¦ä¸²<code>&quot;tencentgamesecfs&quot;</code>ï¼Œå¤§æ¦‚ç‡å°±æ˜¯keyã€‚</li>
<li><code>vm_ctx[1]</code>ï¼š16ï¼Œkeyçš„é•·åº¦ã€‚</li>
<li><code>vm_ctx[2]</code>ï¼šinputã€‚</li>
<li><code>vm_ctx[3]</code>ï¼šä¸€ç‰‡ç©ºçš„å…§å­˜ç©ºé–“ï¼Œå¤§æ¦‚æ˜¯ç”¨ä¾†å­˜æ”¾outputçš„ã€‚</li>
</ul>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image25.png" alt="image.png"></p>
<p><code>sub_46D2754</code>è§£å¯†çš„opcodesæœ€çµ‚æœƒä¿å­˜åœ¨<code>vm_ctx[21]</code>æŒ‡å‘çš„åœ°å€ï¼Œå¤§å°ç‚º<code>0x323C</code>å€‹å­—ç¯€ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image26.png" alt="image.png"></p>
<p>åœ¨<code>vm_init</code>çš„leaveæ™‚æ©Ÿdump opcodesã€‚</p>
<p><code>swap32</code>å‡½æ•¸ç”¨ä¾†ç¿»è½‰å­—ç¯€ï¼Œå› ç‚ºåœ¨ä¹‹å¾Œçš„vmä¸­ä¹Ÿæ˜¯æœƒå°æ¯å€‹opcodeåŸ·è¡Œè©²æ“ä½œï¼Œé€™è£¡æå‰é è™•ç†ä¸‹ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">function</span> <span class="title function_">hook_vm_init</span>(<span class="params">base</span>) &#123;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">swap32</span>(<span class="params">val</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> ((val &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>)</span><br><span class="line">                 | ((val &amp; <span class="number">0xFF00</span>) &lt;&lt; <span class="number">8</span>)</span><br><span class="line">                 | ((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF00</span>)</span><br><span class="line">                 | ((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">dump_opcode</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> opcodes = [];</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x323C</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">              <span class="keyword">let</span> opcode = <span class="title function_">ptr</span>(<span class="title function_">swap32</span>(addr.<span class="title function_">add</span>(i).<span class="title function_">readU32</span>()));</span><br><span class="line">              opcodes.<span class="title function_">push</span>(opcode);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(opcodes.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// vm_init</span></span><br><span class="line">      <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(base.<span class="title function_">add</span>(<span class="number">0x46CFEAC</span>).<span class="title function_">add</span>(<span class="number">1</span>),&#123;</span><br><span class="line">          <span class="title function_">onEnter</span>(<span class="params">args</span>)&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">vm_ctx</span> = args[<span class="number">1</span>];</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="title function_">onLeave</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">              <span class="keyword">let</span> opcodes_addr = <span class="variable language_">this</span>.<span class="property">vm_ctx</span>.<span class="title function_">add</span>(<span class="number">4</span>*<span class="number">21</span>).<span class="title function_">readPointer</span>()</span><br><span class="line">              <span class="title function_">dump_opcode</span>(opcodes_addr)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="vmåˆ†æ"><a href="#vmåˆ†æ" class="headerlink" title="vmåˆ†æ"></a>vmåˆ†æ</h3><p><code>vm_start</code>é–‹é ­çš„ä»£ç¢¼å¦‚ä¸‹ï¼Œ<code>v22</code>æ˜é¡¯æ˜¯<code>opcode</code>ï¼Œè€Œ<code>v22</code>æ˜¯<code>*v18</code>å­—ç¯€ç¿»è½‰è€Œä¾†ï¼Œ<code>v18=vm_ctx[15]</code>ï¼Œå³<code>vm_ctx[15]</code>ç›¸ç•¶æ–¼pcå¯„å­˜å™¨( æŒ‡å‘ä¸‹ä¸€æ¢è¦åŸ·è¡Œçš„æŒ‡ä»¤ )ã€‚</p>
<p>å¾ <code>*v15 += 8</code>ä¹Ÿèƒ½ç¢ºå®š<code>vm_ctx[15]</code>å°±ä»£è¡¨pcã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image27.png" alt="image.png"></p>
<p>å‘ä¸‹çœ‹é‚£å€‹å¤§switchï¼Œæ¯å€‹caseéƒ½å°æ‡‰äº†ä¸åŒçš„handlerï¼Œè€ŒåŸºæœ¬ä¸Šæ¯å€‹handlerè£¡éƒ½æœ‰èª¿ç”¨<code>get_bit</code>å‡½æ•¸ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image28.png" alt="image.png"></p>
<p><code>get_bit</code>å‡½æ•¸å¦‚ä¸‹ï¼Œå…¶å¯¦å°±æ˜¯åœ¨å–<code>a2</code>çš„<code>a3 ~ a4</code>ä½ï¼Œè€Œ<code>a2</code>å›ºå®šæ˜¯opcodeã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image29.png" alt="image.png"></p>
<p>æ¯å€‹handleråœ¨æœ€å¾Œéƒ½æœ‰å°‡<code>pc -= 4</code>çš„æ“ä½œï¼Œè¨˜å¾—åœ¨ä¸Šé¢æ›¾å°‡<code>pc += 8</code>ï¼Œå› æ­¤é€™æ™‚çš„pcæ­£å¥½æŒ‡å‘ä¸‹ä¸€æ¢æŒ‡ä»¤ ( æ¯å€‹opcodeå 4å­—ç¯€ )ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image30.png" alt="image.png"></p>
<p>æ¥è‘—å¾åŒ¯ç·¨è¦–åœ–åˆ†æ<code>JUMPOUT(0x46D156A)</code>ï¼Œç™¼ç¾ç•¶ä¸‹ä¸€æ¢æŒ‡ä»¤ä¸ç‚º0æ™‚ï¼Œå‰‡æœƒè·³å›<code>bswap32</code>ä¸Šé¢ï¼Œç¹¼çºŒåŸ·è¡Œä¸‹ä¸€æ¢æŒ‡ä»¤ã€‚( è·³è½‰æŒ‡ä»¤é™¤å¤– )</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image31.png" alt="image.png"></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image32.png" alt="image.png"></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image33.png" alt="image.png"></p>
<p>ç°¡å–®ç¸½çµä¸‹è©²vmè™›æ“¬æ©Ÿçš„åŸ·è¡Œæµç¨‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> å¾pcå–opcode</span><br><span class="line"><span class="number">2.</span> èª¿ç”¨bswapç¿»è½‰opcode</span><br><span class="line"><span class="number">3.</span> pc += <span class="number">8</span></span><br><span class="line"><span class="number">4.</span> <span class="keyword">switch</span> handler</span><br><span class="line"><span class="number">5.</span> on handler end: pc -= <span class="number">4</span></span><br><span class="line"><span class="number">6.</span> (è·³è½‰æŒ‡ä»¤é™¤å¤–) åˆ¤æ–·pcæŒ‡å‘çš„ä¸‹ä¸€å€‹opcodeæ˜¯å¦ç‚º<span class="number">0</span>, è‹¥æ˜¯å‰‡<span class="keyword">return</span>, å¦å‰‡å›åˆ°ã€<span class="number">1</span>ã€‘</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†å°±æ˜¯åˆ†ææ¯å€‹handlerï¼Œå¾è€Œé‚„åŸvmã€‚</p>
<h3 id="vm-handleråˆ†æ"><a href="#vm-handleråˆ†æ" class="headerlink" title="vm handleråˆ†æ"></a>vm handleråˆ†æ</h3><p>å¾ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œ<code>vm_ctx[15]</code>å°æ‡‰<code>pc</code>ï¼Œ<code>vm_ctx[0 ~ 3]</code>å°æ‡‰<code>r0 ~ r3</code>ã€‚</p>
<p>å†çœ‹handler1ã€handler2ï¼Œæ˜é¡¯æ˜¯å…¥æ£§ã€å‡ºæ£§çš„æ“ä½œï¼Œ<code>vm_ctx[13]</code>å°±æ˜¯<code>sp</code>ï¼ŒåŒæ¨£å°æ‡‰armçš„<code>r13</code>( sp )ã€‚</p>
<p>ç”±æ­¤å¯ä»¥æ¨æ–·ï¼Œæ¯å€‹handleréƒ½èƒ½è½‰æ›æˆèˆ‡å…¶ç­‰åƒ¹( æˆ–å·®ä¸å¤š )çš„armåŒ¯ç·¨æŒ‡ä»¤ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image34.png" alt="image.png"></p>
<p>handler1ã€handler2å°æ‡‰çš„armåŒ¯ç·¨æŒ‡ä»¤æ˜¯<code>push</code>ã€<code>pop</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler1_push</span>(<span class="params">opcode</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;push &#123;r4-r7, lr&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler2_pop</span>(<span class="params">opcode</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;pop &#123;r4-r7, pc&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å†ç°¡å–®è¨˜éŒ„å¹¾å€‹handlerçš„åˆ†æéç¨‹( ä¸»è¦æ˜¯ä¸€äº›åˆ†ææŠ€å·§å’Œä¸€äº›æˆ‘å¾ˆå°‘è¦‹çš„armæŒ‡ä»¤ )ã€‚</p>
<p><strong>handler3åˆ†æï¼š</strong></p>
<p>IDA F5çš„å½ä»£ç¢¼åªèƒ½ä½œç‚ºåƒè€ƒï¼Œå¯¦éš›åˆ†ææ™‚è¦çµåˆåŒ¯ç·¨ä¾†çœ‹ã€‚</p>
<p>å…ˆç”¨frida stalkeræ‰“å°åŒ¯ç·¨åŸ·è¡Œæµï¼Œè¨˜ç‚º<code>trace.log</code>ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(baseAddr.<span class="title function_">add</span>(<span class="number">0x46CFFAC</span>).<span class="title function_">add</span>(<span class="number">1</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[call 46CFFAC]&quot;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tid</span> = <span class="title class_">Process</span>.<span class="title function_">getCurrentThreadId</span>();</span><br><span class="line">        <span class="title class_">Stalker</span>.<span class="title function_">follow</span>(<span class="variable language_">this</span>.<span class="property">tid</span>, &#123;</span><br><span class="line">            <span class="attr">transform</span>: <span class="keyword">function</span>(<span class="params">iterator</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> instruction = iterator.<span class="title function_">next</span>();</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="comment">// é™åˆ¶ç‚ºç•¶å‰æ¨¡å¡Šçš„æŒ‡ä»¤</span></span><br><span class="line">                    <span class="keyword">if</span>(instruction.<span class="property">address</span> &gt;= baseAddr &amp;&amp; instruction.<span class="property">address</span> &lt;= baseAddr.<span class="title function_">add</span>(baseInfo.<span class="property">size</span>)) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;ptr(instruction.address - baseAddr)&#125;</span>: <span class="subst">$&#123;instruction.mnemonic&#125;</span> <span class="subst">$&#123;instruction.opStr&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                    iterator.<span class="title function_">keep</span>();</span><br><span class="line">                &#125; <span class="keyword">while</span>((instruction = iterator.<span class="title function_">next</span>()) != <span class="literal">null</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Stalker</span>.<span class="title function_">unfollow</span>(<span class="variable language_">this</span>.<span class="property">tid</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¾<code>trace.log</code>ä¸€è·¯å‘ä¸Šè·Ÿï¼Œæœƒç™¼ç¾<code>vm_ctx_1</code>å°±æ˜¯<code>vm_start</code>çš„args[1]ï¼Œå³<code>vm_ctx</code>ã€‚</p>
<p>é€™ç„¡æ³•å¾F5çš„å½ä»£ç¢¼ä¸­ç›´æ¥çœ‹å‡ºã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image35.png" alt="image.png"></p>
<p>æ‰¾ä¸åˆ°<code>v12</code>åˆå§‹åŒ–çš„åœ°å€ï¼Œä½†ç™¼ç¾æœ‰å€‹<code>get_bit</code>æ²’æœ‰æ¥æ”¶å…¶è¿”å›å€¼ï¼ŒçŒœæ¸¬å…¶å¯¦å®ƒçš„è¿”å›å€¼è¢«ä¿å­˜åœ¨<code>v12</code>ä¸­ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image36.png" alt="image.png"></p>
<p>åŒæ¨£ç”¨frida stalkerä¾†é©—è­‰ï¼Œç›´æ¥æ‰“å°å¯„å­˜å™¨( <code>r0</code>æ˜¯<code>get_bit</code>çš„è¿”å›å€¼ï¼Œ<code>r8</code>æ˜¯<code>v12</code> )</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title class_">Number</span>(instruction.<span class="property">address</span>) == baseAddr.<span class="title function_">add</span>(<span class="number">0x46D103E</span>)) &#123;</span><br><span class="line">    iterator.<span class="title function_">putCallout</span>(<span class="function">(<span class="params">context</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;r8: &quot;</span>, context.<span class="property">r8</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title class_">Number</span>(instruction.<span class="property">address</span>) == baseAddr.<span class="title function_">add</span>(<span class="number">0x46D0D72</span>)) &#123;</span><br><span class="line">    iterator.<span class="title function_">putCallout</span>(<span class="function">(<span class="params">context</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;r0: &quot;</span>, context.<span class="property">r0</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç™¼ç¾å…©è€…ä¸€è‡´ï¼ŒæˆåŠŸé©—è­‰æƒ³æ³•ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image37.png" alt="image.png"></p>
<p>handler3æ˜¯åŠ æ³•æ“ä½œï¼Œå°æ‡‰çš„armåŒ¯ç·¨æŒ‡ä»¤æ˜¯<code>add</code>ï¼Œæ ¹æ“š<code>get_bit</code>çš„ä¸åŒåˆ†ç‚ºå¯„å­˜å™¨ã€ç«‹å³æ•¸ã€å·¦ç§»ç­‰æƒ…æ³ï¼Œé‚„åŸä»£ç¢¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler3_add</span>(<span class="params">opcode</span>):</span><br><span class="line">    b1 = get_bit(<span class="number">0</span>, opcode, <span class="number">25</span>, <span class="number">27</span>)</span><br><span class="line">    out = get_bit(<span class="number">0</span>, opcode, <span class="number">20</span>, <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">if</span> out == <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;handler3_add 1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    in1 = get_bit(<span class="number">0</span>, opcode, <span class="number">15</span>, <span class="number">20</span>)</span><br><span class="line">    <span class="keyword">if</span> b1:</span><br><span class="line">        <span class="keyword">if</span> b1 == <span class="number">1</span>:</span><br><span class="line">            in2 = get_bit(<span class="number">0</span>, opcode, <span class="number">10</span>, <span class="number">15</span>)</span><br><span class="line">            asm_str = <span class="string">f&quot;add r<span class="subst">&#123;out&#125;</span>, r<span class="subst">&#123;in1&#125;</span>, r<span class="subst">&#123;in2&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> b1 != <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">&quot;handler3_add 2&quot;</span>)</span><br><span class="line">            in2 = get_bit(<span class="number">0</span>, opcode, <span class="number">10</span>, <span class="number">15</span>)</span><br><span class="line">            lsl = get_bit(<span class="number">0</span>, opcode, <span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">            asm_str = <span class="string">f&quot;add r<span class="subst">&#123;out&#125;</span>, r<span class="subst">&#123;in1&#125;</span>, r<span class="subst">&#123;in2&#125;</span>, lsl #<span class="subst">&#123;lsl&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        in2 = get_bit(<span class="number">0</span>, opcode, <span class="number">0</span>, <span class="number">15</span>)</span><br><span class="line">        asm_str = <span class="string">f&quot;add r<span class="subst">&#123;out&#125;</span>, r<span class="subst">&#123;in1&#125;</span>, <span class="subst">&#123;in2&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> asm_str</span><br></pre></td></tr></table></figure>

<p><strong>handler10åˆ†æï¼š</strong></p>
<p><code>vm_ctx[17~20]</code>å‰›å¥½å¯ä»¥å°æ‡‰armçš„CPSRç‹€æ…‹å¯„å­˜å™¨çš„<code>Z</code>ã€<code>N</code>ã€<code>C</code>ã€<code>V</code>ä½ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image38.png" alt="image.png"></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image39.png" alt="image.png"></p>
<p>å› æ­¤handler10å°æ‡‰çš„armåŒ¯ç·¨æŒ‡ä»¤å°±æ˜¯<code>cmp</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler10_cmp</span>(<span class="params">opcode</span>):</span><br><span class="line">    v190 = get_bit(<span class="number">0</span>, opcode, <span class="number">26</span>, <span class="number">27</span>)</span><br><span class="line"></span><br><span class="line">    b = get_bit(<span class="number">0</span>, opcode, <span class="number">21</span>, <span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> v190:</span><br><span class="line">        v143 = get_bit(<span class="number">0</span>, opcode, <span class="number">16</span>, <span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">        asm_str = <span class="string">f&quot;cmp r<span class="subst">&#123;b&#125;</span>, r<span class="subst">&#123;v143&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        v143 = get_bit(<span class="number">0</span>, opcode, <span class="number">0</span>, <span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">        asm_str = <span class="string">f&quot;cmp r<span class="subst">&#123;v190&#125;</span>, <span class="subst">&#123;v143&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> asm_str</span><br></pre></td></tr></table></figure>

<p><strong>handler11åˆ†æï¼š</strong></p>
<p>æ ¹æ“šCPSRé‚£4å€‹æ¨™èªŒä½é€²è¡Œæ¢ä»¶è·³è½‰ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image40.png" alt="image.png"></p>
<p>å°æ‡‰armçš„<code>beq</code>ã€<code>bne</code>ã€<code>bcc</code>ç­‰ä¸åŒçš„æ¢ä»¶è·³è½‰æŒ‡ä»¤ã€‚</p>
<p>æ³¨ï¼šå¯èƒ½é‚„åŸå¾—ä¸å¤ªæ­£ç¢ºï¼Œä½†åŸºæœ¬èƒ½ç”¨å°±ä¸ç®¡äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler11_bcc</span>(<span class="params">opcode</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> branchs</span><br><span class="line">    <span class="keyword">global</span> branch_maps</span><br><span class="line">    v182 = get_bit(<span class="number">0</span>, opcode, <span class="number">23</span>, <span class="number">27</span>)</span><br><span class="line"></span><br><span class="line">    b_reg = <span class="literal">None</span></span><br><span class="line">    b_addr = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> get_bit(<span class="number">0</span>, opcode, <span class="number">22</span>, <span class="number">23</span>):</span><br><span class="line">        b_reg = get_bit(<span class="number">0</span>, opcode, <span class="number">17</span>, <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        b_addr = get_bit(<span class="number">0</span>, opcode, <span class="number">0</span>, <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> b_addr <span class="keyword">and</span> b_addr <span class="keyword">not</span> <span class="keyword">in</span> branch_maps:</span><br><span class="line">        branchs.append(b_addr)</span><br><span class="line">        branch_maps[b_addr] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#17: CPSR_Z</span></span><br><span class="line"><span class="comment">#18: CPSR_N</span></span><br><span class="line"><span class="comment">#19: CPSR_C</span></span><br><span class="line"><span class="comment">#20: CPSR_V</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> b_reg:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;bx r<span class="subst">&#123;b_reg&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> v182 == <span class="number">0</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;b <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">1</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;beq <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">2</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;bne <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">3</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;bcc <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">4</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;bcs <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">5</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;bcc <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">6</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;beq <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">7</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;bge <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">8</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;blt <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">9</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;bgt <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> v182 == <span class="number">10</span>:</span><br><span class="line">        asm_str = <span class="string">f&quot;ble <span class="subst">&#123;<span class="built_in">hex</span>(b_addr)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Error&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> asm_str</span><br></pre></td></tr></table></figure>

<p><strong>handler13åˆ†æï¼š</strong></p>
<p>ç­‰åƒ¹æ–¼armçš„<code>ubfx</code>æŒ‡ä»¤ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image41.png" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler13_ubfx</span>(<span class="params">opcode</span>):</span><br><span class="line">    <span class="comment"># UBFX  Wd, Wn, #lsb, #width    ; 32-bit general registers</span></span><br><span class="line">    <span class="comment"># è§£é‡‹: å¾Wnçš„ç¬¬lsbä½é–‹å§‹æå–widthä½åˆ°Wd (https://blog.csdn.net/LQMIKU/article/details/104361219)</span></span><br><span class="line">    </span><br><span class="line">    v182 = get_bit(<span class="number">0</span>, opcode, <span class="number">22</span>, <span class="number">27</span>)</span><br><span class="line">    v168 = get_bit(<span class="number">0</span>, opcode, <span class="number">17</span>, <span class="number">22</span>)</span><br><span class="line">    v134 = get_bit(<span class="number">0</span>, opcode, <span class="number">8</span>, <span class="number">17</span>)</span><br><span class="line">    v135 = get_bit(<span class="number">0</span>, opcode, <span class="number">0</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    asm_str = <span class="string">f&quot;ubfx r<span class="subst">&#123;v182&#125;</span>, r<span class="subst">&#123;v168&#125;</span>, #<span class="subst">&#123;v134&#125;</span>, #<span class="subst">&#123;v135&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> asm_str</span><br></pre></td></tr></table></figure>

<p><strong>handler18åˆ†æï¼š</strong></p>
<p>ç­‰åƒ¹æ–¼armçš„<code>rev</code>æŒ‡ä»¤( èˆ‡<code>bswap32</code>åŠŸèƒ½ä¸€æ¨£éƒ½æ˜¯å­—ç¯€ç¿»è½‰ )ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image42.png" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler18_rev</span>(<span class="params">opcode</span>):</span><br><span class="line"></span><br><span class="line">    b1 = get_bit(<span class="number">0</span>, opcode, <span class="number">22</span>, <span class="number">27</span>)</span><br><span class="line">    b2 = get_bit(<span class="number">0</span>, opcode, <span class="number">17</span>, <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> b1 == <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;handler18_rev TODO&quot;</span>)</span><br><span class="line">    asm_str = <span class="string">f&quot;rev r<span class="subst">&#123;b1&#125;</span>, r<span class="subst">&#123;b2&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> asm_str</span><br></pre></td></tr></table></figure>

<p><strong>handler20ï¼š</strong></p>
<p>ç­‰åƒ¹æ–¼armçš„<code>rsb</code>æŒ‡ä»¤ã€‚</p>
<p>æŒ‡ä»¤ä¾‹å­ï¼š<code>rsb r0, r1, #10</code> == <code>r0 = 10 - r1</code></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image43.png" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handler20_rsb</span>(<span class="params">opcode</span>):</span><br><span class="line">    <span class="keyword">global</span> vm_ctx</span><br><span class="line"></span><br><span class="line">    b1 = get_bit(<span class="number">0</span>, opcode , <span class="number">22</span>, <span class="number">27</span>)</span><br><span class="line">    b2 = get_bit(<span class="number">0</span>, opcode , <span class="number">17</span>, <span class="number">22</span>)</span><br><span class="line">    b3 = get_bit(<span class="number">0</span>, opcode , <span class="number">0</span>, <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> b1 == <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;handler20_rsb TODO&quot;</span>)</span><br><span class="line"></span><br><span class="line">    asm_str = <span class="string">f&quot;rsb r<span class="subst">&#123;b1&#125;</span>, r<span class="subst">&#123;b2&#125;</span>, #<span class="subst">&#123;b3&#125;</span>&quot;</span></span><br><span class="line">    vm_ctx[b1] = b3 - vm_ctx[b2]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(asm_str)</span><br></pre></td></tr></table></figure>

<h3 id="vmæŒ‡ä»¤é‚„åŸ"><a href="#vmæŒ‡ä»¤é‚„åŸ" class="headerlink" title="vmæŒ‡ä»¤é‚„åŸ"></a>vmæŒ‡ä»¤é‚„åŸ</h3><p>åˆ†æå®Œæ‰€æœ‰handlerå¾Œï¼Œå°±å¯ä»¥å°‡æ‰€æœ‰çš„opcodeéƒ½é‚„åŸæˆarmæŒ‡ä»¤( 4å­—ç¯€çš„opcode â†’ 4å­—ç¯€çš„armæŒ‡ä»¤ )ã€‚</p>
<p>ä»¥BFSçš„æ–¹å¼éæ­·æ‰€æœ‰é‡åˆ°çš„åˆ†æ”¯ï¼šå¾<code>0xE50</code>( <code>opcodes[0xE50/4]</code> )é–‹å§‹åŸ·è¡Œï¼Œèª¿ç”¨<code>start</code>å‡½æ•¸é€²è¡ŒæŒ‡ä»¤è§£æï¼Œåœ¨<code>start</code>è£¡æœƒå°‡é‡åˆ°çš„æ‰€æœ‰åˆ†æ”¯å…¥éšŠã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image44.png" alt="image.png"></p>
<p><code>start</code>å‡½æ•¸å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image45.png" alt="image.png"></p>
<p>æ³¨ï¼šarmæ²’æœ‰<code>r16</code>ï¼Œä½†æˆ‘çš„<code>asm_str</code>è£¡æœƒå‡ºç¾<code>r16</code>ï¼Œå› æ­¤è¦å°‡<code>r16</code>æ›¿æ›ç‚ºå…¶ä»–ä¸ç”¨çš„å¯„å­˜å™¨ï¼Œé€™è£¡é¸æ“‡<code>lr</code>ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image46.png" alt="image.png"></p>
<p>é‚„åŸå¾Œçš„æ–‡ä»¶è¨˜ç‚º<code>vm_code</code>ï¼Œèƒ½è¢«IDAé †åˆ©è§£æï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image47.png" alt="image.png"></p>
<h2 id="Section0ï¼šç™»éŒ„ç®—æ³•é‚„åŸ"><a href="#Section0ï¼šç™»éŒ„ç®—æ³•é‚„åŸ" class="headerlink" title="Section0ï¼šç™»éŒ„ç®—æ³•é‚„åŸ"></a>Section0ï¼šç™»éŒ„ç®—æ³•é‚„åŸ</h2><p>ç”¨Findcryptæ’ä»¶åˆ†æï¼Œç™¼ç¾AESç®—æ³•çš„ç‰¹å¾µã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image48.png" alt="image.png"></p>
<p>èˆ‡<a target="_blank" rel="noopener" href="https://github.com/manvelmk/AES-Rijndael-Encryption/tree/master">ç¶²ä¸Šæ‰¾çš„AESè…³æœ¬</a>å°æ¯”ï¼Œå¯ä»¥çœ‹å‡ºæ•´é«”åŠ å¯†çµæ§‹æ˜¯ä¸€è‡´çš„ï¼Œä½†<code>Sub_Bytes</code>ã€<code>Shift_Rows</code>ç­‰å‡½æ•¸çš„å¯¦ç¾å°±æœ‰æ‰€ä¸åŒã€‚</p>
<p>åŸç‰ˆAESï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Encrypt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j,round=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">// Copy plaintext to state array</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			state[j][i] = plaintext[i * <span class="number">4</span> + j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Add the first round key to the state before starting the rounds</span></span><br><span class="line">	<span class="built_in">Add_Round_Key</span>(<span class="number">0</span>); </span><br><span class="line">	<span class="comment">// The first rounds-1 rounds are the same</span></span><br><span class="line">	<span class="keyword">for</span> (round = <span class="number">1</span>; round &lt; rounds; round++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">Sub_Bytes</span>();</span><br><span class="line">		<span class="built_in">Shift_Rows</span>();</span><br><span class="line">		<span class="built_in">Mix_Columns</span>();</span><br><span class="line">		<span class="built_in">Add_Round_Key</span>(round);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Last round has no Mix_Columns()</span></span><br><span class="line">	<span class="built_in">Sub_Bytes</span>();</span><br><span class="line">	<span class="built_in">Shift_Rows</span>();</span><br><span class="line">	<span class="built_in">Add_Round_Key</span>(rounds);</span><br><span class="line">	<span class="comment">// Copy the state array to output</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			encrypted[i * <span class="number">4</span> + j] = state[j][i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>vm_code</code> IDAå½ä»£ç¢¼ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image49.png" alt="image.png"></p>
<p>å°‡ä¸€äº›å‡½æ•¸æŒ‰åŸç‰ˆAESé‡å‘½åå¾Œï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image50.png" alt="image.png"></p>
<p>åœ¨æ­£å¼é–‹å§‹ç®—æ³•é‚„åŸå‰ï¼Œéœ€å¾çœŸå¯¦ç’°å¢ƒæå–ä¸€çµ„çš„inputã€outputæ•¸æ“šï¼Œä½œç‚ºä¹‹å¾Œæ¸¬è©¦ç®—æ³•æ˜¯å¦æ­£ç¢ºçš„ä¾æ“šï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">input: <span class="number">01230123012301230123012301230123</span></span><br><span class="line"></span><br><span class="line">res:             <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>  A  B  C  D  E  F  <span class="number">0123456789</span>ABCDEF</span><br><span class="line">c0889100  d5 <span class="number">1</span>d <span class="number">78</span> a3 <span class="number">4f</span> <span class="number">12</span> <span class="number">05</span> <span class="number">88</span> <span class="number">18</span> a2 f8 d5 <span class="number">44</span> <span class="number">56</span> a7 d2  ..x.O.......DV..</span><br><span class="line">c0889110  d5 <span class="number">1</span>d <span class="number">78</span> a3 <span class="number">4f</span> <span class="number">12</span> <span class="number">05</span> <span class="number">88</span> <span class="number">18</span> a2 f8 d5 <span class="number">44</span> <span class="number">56</span> a7 d2  ..x.O.......DV..</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†æ˜¯æˆ‘é€²è¡Œç®—æ³•é‚„åŸçš„æ€è·¯ï¼Œåƒ…ä¾›åƒè€ƒã€‚</p>
<p>å…ˆå°‡IDAçš„å½ä»£ç¢¼æ‰£ä¸‹ä¾†ï¼Œçœ‹çœ‹åŠ å¯†çµæœèˆ‡çœŸå¯¦ç’°å¢ƒä¸­çš„æ˜¯å¦ä¸€è‡´ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image51.png" alt="image.png"></p>
<p>ä¸å‡ºæ‰€æ–™ï¼Œæœç„¶ä¸ä¸€æ¨£ï¼ŒåŸå› å¯èƒ½æ˜¯vmæŒ‡ä»¤é‚„åŸé‚£éƒ¨ä»½å‡ºäº†éŒ¯ï¼Œåˆæˆ–è€…æ˜¯IDAçš„å•é¡Œï¼Œéƒ½æœ‰å¯èƒ½ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image52.png" alt="image.png"></p>
<p>åˆ°åº•å“ªè£¡å‡ºäº†éŒ¯æš«æ™‚ä¸çŸ¥ï¼Œå…ˆå‡è¨­vmæŒ‡ä»¤é‚„åŸé‚£éƒ¨ä»½æ²’æœ‰å‡ºéŒ¯ï¼Œå³<code>vm_code</code>çš„armåŒ¯ç·¨æŒ‡ä»¤æ˜¯æ­£ç¢ºçš„ï¼Œç„¶å¾Œèª¿è©¦çœ‹çœ‹ã€‚</p>
<p>å¦‚ä½•èª¿è©¦ï¼Ÿå°æ–¼vmæŒ‡ä»¤é‚„åŸå¾Œçš„ç¨‹åºï¼Œæ‡‰è©²ä¸å­˜åœ¨ä¸€ç¨®ç›´æ¥èª¿è©¦çš„æ‰‹æ®µï¼Œæˆ‘æƒ³åˆ°çš„ä¸€ç¨®æ€è·¯æ˜¯å€ŸåŠ©Unicornä¾†é–“æ¥åœ°èª¿è©¦ã€‚</p>
<p><strong>æ³¨ï¼šé€™è£¡çš„èª¿è©¦ä¸¦éå‚³çµ±æ„ç¾©ä¸Šçš„æ‰“æ–·é» â†’ å–®æ­¥åŸ·è¡Œèª¿è©¦ï¼Œè€Œæ˜¯åå‘æ–¼åœ¨æŸæ¢åŒ¯ç·¨æŒ‡ä»¤åŸ·è¡Œå¾Œï¼Œæ‰“å°æŸå¯„å­˜å™¨ã€hexdumpæŸå…§å­˜åœ°å€ï¼Œçœ‹çœ‹æ•¸æ“šæ˜¯å¦ç¬¦åˆé æœŸã€‚</strong></p>
<h3 id="Unicornè¼”åŠ©èª¿è©¦ç®—æ³•å‡ºéŒ¯çš„åŸå› "><a href="#Unicornè¼”åŠ©èª¿è©¦ç®—æ³•å‡ºéŒ¯çš„åŸå› " class="headerlink" title="Unicornè¼”åŠ©èª¿è©¦ç®—æ³•å‡ºéŒ¯çš„åŸå› "></a>Unicornè¼”åŠ©èª¿è©¦ç®—æ³•å‡ºéŒ¯çš„åŸå› </h3><p>å…ˆçœ‹çœ‹Unicornæ¨¡æ“¬åŸ·è¡Œçš„çµæœæ˜¯å¦èˆ‡çœŸå¯¦ç’°å¢ƒä¸€è‡´( æ²¿ç”¨ä¸Šé¢è§£æ··æ·†çš„Unicornä»£ç¢¼ )ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°å®Œå…¨ä¸€æ¨£ï¼Œå³æ¨¡æ“¬åŸ·è¡Œçš„ç’°å¢ƒæ²’æœ‰ä»»ä½•å•é¡Œã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image53.png" alt="image.png"></p>
<p>å®šç¾©ä¸€äº›è¼”åŠ©å‡½æ•¸ï¼Œæ–¹ä¾¿èª¿è©¦è§€å¯Ÿã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_vm_reg</span>(<span class="params">emu:Uc, idx</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> g_vmctx:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;g_vmctx == None&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(emu.mem_read(g_vmctx + <span class="number">4</span> * idx, <span class="number">0x4</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hexdump</span>(<span class="params">emu:Uc, addr, <span class="built_in">len</span></span>):</span><br><span class="line">    res = emu.mem_read(addr, <span class="built_in">len</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">hex</span>(addr)&#125;</span>:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(res[i])[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>), end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (i+<span class="number">1</span>) % <span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot; |  <span class="subst">&#123;res[i-<span class="number">15</span>: i+<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex2str</span>(<span class="params">hexstr: <span class="built_in">str</span></span>):</span><br><span class="line">    hexstr = hexstr.replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytearray</span>.fromhex(hexstr).decode()[::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>å…·é«”èª¿è©¦æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ·»åŠ ä¸€å€‹<code>UC_HOOK_CODE</code>ä¾†hookæ¯æ¢åŸ·è¡Œçš„åŒ¯ç·¨æŒ‡ä»¤ï¼Œåœ¨åˆé©çš„æ™‚æ©Ÿä¿å­˜<code>vm_ctx</code>ã€‚ åœ¨<code>bl bswap32_0</code>çš„ä¸‹ä¸€æ¢åŒ¯ç·¨é€™å€‹æ™‚æ©Ÿèª¿ç”¨<code>on_opcode</code>ï¼Œé€™æ™‚å¯ä»¥ç›£æ§åŸ·è¡Œéç¨‹çš„æ¯å€‹opcodeã€‚ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g_vmctx = <span class="literal">None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">emu: Uc, addr, size, user_data</span>):</span><br><span class="line">    <span class="keyword">global</span> g_vmctx</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> addr == libUE4_base + <span class="number">0x46CFFBC</span>:</span><br><span class="line">        g_vmctx = emu.reg_read(UC_ARM_REG_R10)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> addr == libUE4_base + <span class="number">0x46D002C</span>:</span><br><span class="line">        on_opcode(emu)</span><br></pre></td></tr></table></figure>
</li>
<li>opcodeåŸºæœ¬ä¸Šéƒ½æœƒé‡è¤‡ï¼Œå› æ­¤è¦èª¿è©¦<code>vm_code</code>æŸåœ°å€çš„åŒ¯ç·¨æŒ‡ä»¤æ™‚ï¼Œè¦é€šé2å€‹opcodeæ‰èƒ½ç¢ºå®šã€‚ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">count = -<span class="number">1</span> <span class="comment"># ä»£è¡¨åœ¨opcodeAå¾Œçš„ç¬¬&#123;count&#125;æ¢æŒ‡ä»¤æ™‚æ‰“å°</span></span><br><span class="line">g_addr = <span class="literal">None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_opcode</span>(<span class="params">emu: Uc</span>):</span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line">    <span class="keyword">global</span> g_addr</span><br><span class="line">    opcode = emu.reg_read(UC_ARM_REG_R0)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count != -<span class="number">1</span>:</span><br><span class="line">        count -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> opcode == <span class="number">0x1ac7b000</span>:</span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">0</span> <span class="keyword">and</span> opcode == <span class="number">0x38d58300</span>:</span><br><span class="line">        r3 = read_vm_reg(emu, <span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;r3: &quot;</span>, <span class="built_in">hex</span>(r3))</span><br></pre></td></tr></table></figure>
 ä¾‹å­ï¼šç›®æ¨™æ˜¯<code>vm_code</code>è£¡<code>0x7DC</code>é€™æ¢åŒ¯ç·¨æŒ‡ä»¤ã€‚ <img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image54.png" alt="image.png"> <code>0x7DC</code>ä¸Šä¸€æ¢æŒ‡ä»¤å°æ‡‰çš„opcodeç‚º<code>opcodes[0x7D8/4]</code> = <code>0x1ac7b000</code>ã€‚ <code>0x7DC</code>å°æ‡‰çš„opcodeç‚º<code>opcodes[0x7DC/4]</code> = <code>0x38d58300</code>ã€‚ <img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image55.png" alt="image.png"> åˆ©ç”¨<code>0x1ac7b000</code>ã€<code>0x38d58300</code>é€™2å€‹opcodeå°±åŸºæœ¬èƒ½ç¢ºå®šæ˜¯<code>vm_code</code>çš„<code>0x7DC</code>ã€‚</li>
</ol>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image56.png" alt="image.png"></p>
<p>æ¥ä¸‹ä¾†å°±æ˜¯æ‰¾ä¸åŒçš„éç¨‹ï¼Œå…ˆçœ‹<code>aes_key_schedule</code>çš„çµæœèˆ‡æœ¬åœ°æ˜¯å¦ä¸åŒã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image57.png" alt="image.png"></p>
<p>æŒ‰ä¸Šè¿°èª¿è©¦æ€è·¯ï¼Œæ‰“å°<code>aes_key_schedule</code>çš„è¿”å›å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">on_opcode</span>(<span class="params">emu: Uc</span>):</span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line">    <span class="keyword">global</span> g_addr</span><br><span class="line">    opcode = emu.reg_read(UC_ARM_REG_R0)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count != -<span class="number">1</span>:</span><br><span class="line">        count -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print 0x6F0 return ( save in args[2] )</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">0</span> <span class="keyword">and</span> opcode == <span class="number">0x58000798</span>:</span><br><span class="line">        count = -<span class="number">1</span></span><br><span class="line">        r1 = read_vm_reg(emu, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> g_addr:</span><br><span class="line">            g_addr = r1</span><br><span class="line">    <span class="keyword">if</span> opcode == <span class="number">0x40002000</span>:</span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> opcode == <span class="number">0x10008800</span>:</span><br><span class="line">        <span class="keyword">if</span> g_addr:</span><br><span class="line">            hexdump(emu, g_addr, <span class="number">0x160</span>)</span><br></pre></td></tr></table></figure>

<p>è¼¸å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">63</span> 6e <span class="number">65</span> <span class="number">74</span> <span class="number">67</span> <span class="number">74</span> 6e <span class="number">65</span> <span class="number">73</span> <span class="number">65</span> 6d <span class="number">61</span> <span class="number">73</span> <span class="number">66</span> <span class="number">63</span> <span class="number">65</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;cnetgtnesemasfce&#x27;</span>)</span><br><span class="line">2e e1 <span class="number">56</span> 8e <span class="number">49</span> <span class="number">95</span> <span class="number">38</span> eb 3a f0 <span class="number">55</span> 8a <span class="number">49</span> <span class="number">96</span> <span class="number">36</span> ef  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;.\xe1V\x8eI\x958\xeb:\xf0U\x8aI\x966\xef&#x27;</span>)</span><br><span class="line">f1 da c6 <span class="number">89</span> b8 4f fe <span class="number">62</span> <span class="number">82</span> bf ab e8 cb <span class="number">29</span> 9d 07  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\xf1\xda\xc6\x89\xb8O\xfeb\x82\xbf\xab\xe8\xcb)\x9d\x07&#x27;</span>)</span><br><span class="line"><span class="number">34</span> c5 <span class="number">63</span> d3 8c 8a 9d b1 0e <span class="number">35</span> <span class="number">36</span> <span class="number">59</span> c5 1c ab 5e  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;4\xc5c\xd3\x8c\x8a\x9d\xb1\x0e56Y\xc5\x1c\xab^&#x27;</span>)</span><br><span class="line">6c <span class="number">63</span> ff b9 e0 e9 <span class="number">62</span> 08 ee dc <span class="number">54</span> <span class="number">51</span> 2b c0 ff 0f  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;lc\xff\xb9\xe0\xe9b\x08\xee\xdcTQ+\xc0\xff\x0f&#x27;</span>)</span><br><span class="line">1a <span class="number">92</span> <span class="number">45</span> bf fa 7b <span class="number">27</span> b7 <span class="number">14</span> a7 <span class="number">73</span> e6 3f <span class="number">67</span> 8c e9  |  <span class="built_in">bytearray</span>(<span class="string">b&quot;\x1a\x92E\xbf\xfa&#123;\&#x27;\xb7\x14\xa7s\xe6?g\x8c\xe9&quot;</span>)</span><br><span class="line">04 e7 c0 fb fe 9c e7 4c ea 3b <span class="number">94</span> aa d5 5c <span class="number">18</span> <span class="number">43</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x04\xe7\xc0\xfb\xfe\x9c\xe7L\xea;\x94\xaa\xd5\\\x18C&#x27;</span>)</span><br><span class="line">1e e4 8a <span class="number">16</span> e0 <span class="number">78</span> 6d 5a 0a <span class="number">43</span> f9 f0 df 1f e1 b3  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x1e\xe4\x8a\x16\xe0xmZ\nC\xf9\xf0\xdf\x1f\xe1\xb3&#x27;</span>)</span><br><span class="line"><span class="number">73</span> 7a 4a 6e <span class="number">93</span> 02 <span class="number">27</span> <span class="number">34</span> <span class="number">99</span> <span class="number">41</span> de c4 <span class="number">46</span> 5e 3f <span class="number">77</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&quot;szJn\x93\x02\&#x27;4\x99A\xde\xc4F^?w&quot;</span>)</span><br><span class="line"><span class="number">86</span> <span class="number">20</span> <span class="number">12</span> <span class="number">00</span> <span class="number">15</span> <span class="number">22</span> <span class="number">35</span> <span class="number">34</span> 8c <span class="number">63</span> eb f0 ca 3d d4 <span class="number">87</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x86 \x12\x00\x15&quot;54\x8cc\xeb\xf0\xca=\xd4\x87&#x27;</span>)</span><br><span class="line"><span class="number">91</span> <span class="number">54</span> <span class="number">35</span> 7e <span class="number">84</span> <span class="number">76</span> <span class="number">00</span> 4a 08 <span class="number">15</span> eb ba c2 <span class="number">28</span> 3f 3d  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x91T5~\x84v\x00J\x08\x15\xeb\xba\xc2(?=&#x27;</span>)</span><br><span class="line"><span class="number">91</span> <span class="number">54</span> <span class="number">35</span> 7e <span class="number">84</span> <span class="number">76</span> <span class="number">00</span> 4a 08 <span class="number">15</span> eb ba c2 <span class="number">28</span> 3f 3d  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x91T5~\x84v\x00J\x08\x15\xeb\xba\xc2(?=&#x27;</span>)</span><br><span class="line"><span class="number">86</span> <span class="number">20</span> <span class="number">12</span> <span class="number">00</span> <span class="number">15</span> <span class="number">22</span> <span class="number">35</span> <span class="number">34</span> 8c <span class="number">63</span> eb f0 ca 3d d4 <span class="number">87</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x86 \x12\x00\x15&quot;54\x8cc\xeb\xf0\xca=\xd4\x87&#x27;</span>)</span><br><span class="line"><span class="number">73</span> 7a 4a 6e <span class="number">93</span> 02 <span class="number">27</span> <span class="number">34</span> <span class="number">99</span> <span class="number">41</span> de c4 <span class="number">46</span> 5e 3f <span class="number">77</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&quot;szJn\x93\x02\&#x27;4\x99A\xde\xc4F^?w&quot;</span>)</span><br><span class="line">1e e4 8a <span class="number">16</span> e0 <span class="number">78</span> 6d 5a 0a <span class="number">43</span> f9 f0 df 1f e1 b3  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x1e\xe4\x8a\x16\xe0xmZ\nC\xf9\xf0\xdf\x1f\xe1\xb3&#x27;</span>)</span><br><span class="line">04 e7 c0 fb fe 9c e7 4c ea 3b <span class="number">94</span> aa d5 5c <span class="number">18</span> <span class="number">43</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x04\xe7\xc0\xfb\xfe\x9c\xe7L\xea;\x94\xaa\xd5\\\x18C&#x27;</span>)</span><br><span class="line">1a <span class="number">92</span> <span class="number">45</span> bf fa 7b <span class="number">27</span> b7 <span class="number">14</span> a7 <span class="number">73</span> e6 3f <span class="number">67</span> 8c e9  |  <span class="built_in">bytearray</span>(<span class="string">b&quot;\x1a\x92E\xbf\xfa&#123;\&#x27;\xb7\x14\xa7s\xe6?g\x8c\xe9&quot;</span>)</span><br><span class="line">6c <span class="number">63</span> ff b9 e0 e9 <span class="number">62</span> 08 ee dc <span class="number">54</span> <span class="number">51</span> 2b c0 ff 0f  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;lc\xff\xb9\xe0\xe9b\x08\xee\xdcTQ+\xc0\xff\x0f&#x27;</span>)</span><br><span class="line"><span class="number">34</span> c5 <span class="number">63</span> d3 8c 8a 9d b1 0e <span class="number">35</span> <span class="number">36</span> <span class="number">59</span> c5 1c ab 5e  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;4\xc5c\xd3\x8c\x8a\x9d\xb1\x0e56Y\xc5\x1c\xab^&#x27;</span>)</span><br><span class="line">f1 da c6 <span class="number">89</span> b8 4f fe <span class="number">62</span> <span class="number">82</span> bf ab e8 cb <span class="number">29</span> 9d 07  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;\xf1\xda\xc6\x89\xb8O\xfeb\x82\xbf\xab\xe8\xcb)\x9d\x07&#x27;</span>)</span><br><span class="line">2e e1 <span class="number">56</span> 8e <span class="number">49</span> <span class="number">95</span> <span class="number">38</span> eb 3a f0 <span class="number">55</span> 8a <span class="number">49</span> <span class="number">96</span> <span class="number">36</span> ef  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;.\xe1V\x8eI\x958\xeb:\xf0U\x8aI\x966\xef&#x27;</span>)</span><br><span class="line"><span class="number">63</span> 6e <span class="number">65</span> <span class="number">74</span> <span class="number">67</span> <span class="number">74</span> 6e <span class="number">65</span> <span class="number">73</span> <span class="number">65</span> 6d <span class="number">61</span> <span class="number">73</span> <span class="number">66</span> <span class="number">63</span> <span class="number">65</span>  |  <span class="built_in">bytearray</span>(<span class="string">b&#x27;cnetgtnesemasfce&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å†çœ‹æœ¬åœ°é‹ç®—çš„çµæœï¼Œå¾ç¬¬2è¡Œé–‹å§‹å°±ä¸ä¸€æ¨£äº†ï¼Œç”±æ­¤ç¢ºå®šæœ¬åœ°çš„<code>aes_key_schedule</code>å¯¦ç¾æœ‰å•é¡Œã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image58.png" alt="image.png"></p>
<p>ç„¶å¾Œå°±æ˜¯æ¼«é•·åœ°é‡è¤‡ä¸Šè¿°çš„èª¿è©¦éç¨‹ï¼Œå˜—è©¦æ‰¾å‡ºé‚£å€‹ä¸ç¬¦åˆé æœŸçš„åœ°æ–¹ã€‚</p>
<p>çœ‹äº†å¥½å¹¾è™•é‹ç®—çš„åœ°æ–¹ï¼Œæœ¬åœ°çµæœèˆ‡çœŸå¯¦ç’°å¢ƒä¸­éƒ½ä¸€æ¨£ï¼Œç›´åˆ°æˆ‘çœ‹åˆ°<code>HIBYTE</code>ï¼Œè®“æˆ‘å›æƒ³èµ·ä¹‹å‰åŒæ¨£åœ¨é€²è¡Œç®—æ³•é‚„åŸæ™‚ï¼Œå°±æ˜¯è¢«<code>HIBYTE</code>å‘äº†å¾ˆä¹…ï¼ŒIDAå½ä»£ç¢¼ä¸­çš„<code>HIBYTE</code>å¯¦éš›ä¸Šæ˜¯<code>BYTE3</code>æ‰å°ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image59.png" alt="image.png"></p>
<p>å˜—è©¦å°‡æ‰€æœ‰<code>HIBYTE</code>éƒ½æ”¹æˆ<code>BYTE3</code>ï¼Œçµæœå°±æ­£ç¢ºäº†ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image60.png" alt="image.png"></p>
<h3 id="åæ¨è§£å¯†ç®—æ³•"><a href="#åæ¨è§£å¯†ç®—æ³•" class="headerlink" title="åæ¨è§£å¯†ç®—æ³•"></a>åæ¨è§£å¯†ç®—æ³•</h3><p>ä¸Šä¸€å°ç¯€ä¸­æˆåŠŸä¿®å¾©äº†IDAæ‰£ä¸‹ä¾†çš„é­”æ”¹AESåŠ å¯†ç®—æ³•ï¼Œä»¥æ­¤ä½œç‚ºæ ¹æ“š + åƒè€ƒåŸç‰ˆAESè§£å¯†é‚è¼¯ + å•GPTå¾ˆå®¹æ˜“å¯ä»¥å¾—å‡ºè§£å¯†ç®—æ³•ã€‚</p>
<p>å…ˆç°¡å–®åˆ†ææ¯å€‹å‡½æ•¸ï¼Œçœ‹çœ‹éœ€ä¸éœ€è¦æ”¹æˆé€†å‡½æ•¸ç”¨æ–¼è§£å¯†ã€‚</p>
<ol>
<li><code>aes_key_schedule</code>ï¼šå¯†é‘°æ“´å±•ï¼Œä¸éœ€è¦æ”¹ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">aes_key_schedule</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span>* output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> m; <span class="comment">// [sp+0h] [bp-28h]</span></span><br><span class="line">    <span class="type">int</span> k; <span class="comment">// [sp+4h] [bp-24h]</span></span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// [sp+8h] [bp-20h]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [sp+Ch] [bp-1Ch]</span></span><br><span class="line">    <span class="type">int</span>* v8; <span class="comment">// [sp+10h] [bp-18h]</span></span><br><span class="line">    <span class="type">int</span>* v9; <span class="comment">// [sp+14h] [bp-14h]</span></span><br><span class="line">    <span class="type">int</span>* v10; <span class="comment">// [sp+14h] [bp-14h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!a1 || !output)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (a2 != <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    v9 = output;</span><br><span class="line">    v8 = output + <span class="number">44</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">        output[i] = <span class="built_in">bswap32</span>(*(<span class="type">int</span>*)(a1 + <span class="number">4</span> * i));</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">10</span>; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        v9[<span class="number">4</span>] = *v9 ^ ((RijnDael_AES_LONG_3000[(<span class="type">unsigned</span> __int8)<span class="built_in">BYTE2</span>(v9[<span class="number">3</span>])] &lt;&lt; <span class="number">24</span>) | (RijnDael_AES_LONG_3000[<span class="built_in">BYTE1</span>(v9[<span class="number">3</span>])] &lt;&lt; <span class="number">16</span>) | (RijnDael_AES_LONG_3000[(<span class="type">unsigned</span> __int8)v9[<span class="number">3</span>]] &lt;&lt; <span class="number">8</span>) | RijnDael_AES_LONG_3000[<span class="built_in">BYTE3</span>(v9[<span class="number">3</span>])]) ^ dword_1388[j];</span><br><span class="line">        v9[<span class="number">5</span>] = v9[<span class="number">1</span>] ^ v9[<span class="number">4</span>];</span><br><span class="line">        v9[<span class="number">6</span>] = v9[<span class="number">2</span>] ^ v9[<span class="number">5</span>];</span><br><span class="line">        v9[<span class="number">7</span>] = v9[<span class="number">3</span>] ^ v9[<span class="number">6</span>];</span><br><span class="line">        v9 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v10 = output + <span class="number">40</span>;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">11</span>; ++k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (m = <span class="number">0</span>; m &lt; <span class="number">4</span>; ++m)</span><br><span class="line">            v8[m] = v10[m];</span><br><span class="line">        v10 -= <span class="number">4</span>;</span><br><span class="line">        v8 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><code>transpose</code>ï¼šåªæ˜¯å°‡è¼¸å…¥è½‰ç½®ä¸€ä¸‹ï¼Œä¸éœ€è¦æ”¹ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">transpose</span><span class="params">(<span class="type">int</span> a1, _BYTE* a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _BYTE* v2; <span class="comment">// r0</span></span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// [sp+0h] [bp-10h]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [sp+4h] [bp-Ch]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            v2 = a2++;</span><br><span class="line">            *(_BYTE*)(a1 + <span class="number">4</span> * j + i) = *v2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><code>Add_Round_Key</code>ï¼šinputç•°æˆ–è¼ªå¯†é‘°ï¼Œä¸éœ€è¦æ”¹ï¼Œä½†å‚³å…¥çš„è¼ªå¯†é‘°é †åºè¦ç”±å¾Œâ†’å‰ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">Add_Round_Key</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span>  <span class="comment">// Add_Round_Key</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// [sp+0h] [bp-20h]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [sp+4h] [bp-1Ch]</span></span><br><span class="line">    _DWORD v5[<span class="number">4</span>]; <span class="comment">// [sp+8h] [bp-18h] BYREF</span></span><br><span class="line">    <span class="type">int</span> v6; <span class="comment">// [sp+18h] [bp-8h]</span></span><br><span class="line">    <span class="type">int</span> v7; <span class="comment">// [sp+1Ch] [bp-4h]</span></span><br><span class="line"></span><br><span class="line">    v7 = a1;</span><br><span class="line">    v6 = a2;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            *((_BYTE*)&amp;v5[i] + j) = *(_DWORD*)(v6 + <span class="number">4</span> * j) &gt;&gt; (<span class="number">8</span> * (<span class="number">3</span> - i));</span><br><span class="line">            *(_BYTE*)(v7 + <span class="number">4</span> * i + j) ^= *((_BYTE*)&amp;v5[i] + j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><code>Sub_Bytes</code>ï¼šåŠ å¯†æ™‚æŸ¥è©¢çš„æ˜¯é€†Sç›’ï¼Œè§£å¯†æ™‚è¦æ”¹æˆSç›’ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">Sub_Bytes</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// [sp+0h] [bp-Ch]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [sp+4h] [bp-8h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)</span><br><span class="line">            *(_BYTE*)(a1 + <span class="number">4</span> * i + j) = RijnDael_AES_LONG_inv_3100[*(<span class="type">unsigned</span> __int8*)(j + a1 + <span class="number">4</span> * i)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><code>Shift_Rows</code>ï¼š<code>__ROR4__(v3[i], 8 * i)</code>æ˜¯å¯é€†çš„ï¼Œè§£å¯†æ™‚è¦æ”¹æˆ<code>__ROR4__(v3[i], 32 - 8 * i)</code>ã€‚ <code>__ROR4__(val, n)</code>è§£æï¼šå°‡<code>val</code>å³ç§»çš„<code>n</code>ä½ä¿å­˜ä¸‹ä¾†ï¼Œç„¶å¾Œåœ¨<code>val</code>å³ç§»å¾Œæ‹¼åˆ°<code>val</code>çš„é«˜ä½ã€‚ Encryptï¼š<code>__ROR4__(0xfd84a748, 8)</code>   = <code>0x48fd84a7</code>ã€‚ Decryptï¼š<code>__ROR4__(0x48fd84a7, 24)</code> = <code>0xfd84a748</code>ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">Shift_Rows</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [sp+0h] [bp-18h]</span></span><br><span class="line">    _DWORD v3[<span class="number">4</span>]; <span class="comment">// [sp+4h] [bp-14h] BYREF</span></span><br><span class="line">    <span class="type">int</span> v4; <span class="comment">// [sp+14h] [bp-4h]</span></span><br><span class="line"></span><br><span class="line">    v4 = a1;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        v3[i] = <span class="built_in">bswap32</span>(*(_DWORD*)(v4 + <span class="number">4</span> * i));</span><br><span class="line">        v3[i] = __ROR4__(v3[i], <span class="number">8</span> * i);</span><br><span class="line">        *(_BYTE*)(v4 + <span class="number">4</span> * i) = <span class="built_in">BYTE3</span>(v3[i]);  <span class="comment">// nglog: HIBYTE -&gt; BYTE3</span></span><br><span class="line">        *(_BYTE*)(v4 + <span class="number">4</span> * i + <span class="number">1</span>) = <span class="built_in">HIWORD</span>(v3[i]);</span><br><span class="line">        *(_BYTE*)(v4 + <span class="number">4</span> * i + <span class="number">2</span>) = <span class="built_in">BYTE1</span>(v3[i]);</span><br><span class="line">        *(_BYTE*)(v4 + <span class="number">4</span> * i + <span class="number">3</span>) = v3[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><code>Mix_Columns</code>ï¼šå°çŸ©é™£çš„åˆ—é€²è¡Œç·šæ€§è½‰æ›ï¼Œç›´æ¥å•GPTå–å¾—å…¶é€†å‡½æ•¸ã€‚ <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">Mix_Columns</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> v1; <span class="comment">// r0</span></span><br><span class="line">    <span class="type">int</span> v3; <span class="comment">// [sp+0h] [bp-48h]</span></span><br><span class="line">    <span class="type">int</span> v4; <span class="comment">// [sp+4h] [bp-44h]</span></span><br><span class="line">    <span class="type">int</span> v5; <span class="comment">// [sp+8h] [bp-40h]</span></span><br><span class="line">    <span class="type">int</span> m; <span class="comment">// [sp+14h] [bp-34h]</span></span><br><span class="line">    <span class="type">int</span> k; <span class="comment">// [sp+18h] [bp-30h]</span></span><br><span class="line">    <span class="type">int</span> j; <span class="comment">// [sp+1Ch] [bp-2Ch]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [sp+20h] [bp-28h]</span></span><br><span class="line">    <span class="type">char</span> v10[<span class="number">32</span>]; <span class="comment">// [sp+24h] [bp-24h] BYREF</span></span><br><span class="line">    <span class="type">int</span> v11; <span class="comment">// [sp+44h] [bp-4h]</span></span><br><span class="line"></span><br><span class="line">    v11 = a1;</span><br><span class="line">    v10[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">    v10[<span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">    v10[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">4</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">5</span>] = <span class="number">2</span>;</span><br><span class="line">    v10[<span class="number">6</span>] = <span class="number">3</span>;</span><br><span class="line">    v10[<span class="number">7</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">8</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">9</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">10</span>] = <span class="number">2</span>;</span><br><span class="line">    v10[<span class="number">11</span>] = <span class="number">3</span>;</span><br><span class="line">    v10[<span class="number">12</span>] = <span class="number">3</span>;</span><br><span class="line">    v10[<span class="number">13</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">14</span>] = <span class="number">1</span>;</span><br><span class="line">    v10[<span class="number">15</span>] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)</span><br><span class="line">            v10[<span class="number">4</span> * i + <span class="number">16</span> + j] = *(_BYTE*)(j + v11 + <span class="number">4</span> * i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">4</span>; ++k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (m = <span class="number">0</span>; m &lt; <span class="number">4</span>; ++m)</span><br><span class="line">        &#123;</span><br><span class="line">            v5 = <span class="built_in">sub_B64</span>(v10[<span class="number">4</span> * k], v10[m + <span class="number">16</span>]);</span><br><span class="line">            v4 = v5 ^ <span class="built_in">sub_B64</span>(v10[<span class="number">4</span> * k + <span class="number">1</span>], v10[m + <span class="number">20</span>]);</span><br><span class="line">            v3 = v4 ^ <span class="built_in">sub_B64</span>(v10[<span class="number">4</span> * k + <span class="number">2</span>], v10[m + <span class="number">24</span>]);</span><br><span class="line">            v1 = <span class="built_in">sub_B64</span>(v10[<span class="number">4</span> * k + <span class="number">3</span>], v10[m + <span class="number">28</span>]);</span><br><span class="line">            *(_BYTE*)(v11 + <span class="number">4</span> * k + m) = v3 ^ v1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ç„¶å¾Œå˜—è©¦è§£å¯†ç™»éŒ„çš„å¯†æ–‡ï¼Œå¾—å‡ºçµæœç‚º<code>dde8cdf098e8434b93f04f86085a88f9</code>ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image61.png" alt="image.png"></p>
<p>è¼¸å…¥å¾ŒæˆåŠŸé€²å…¥éŠæˆ²ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image62.png" alt="image.png"></p>
<h2 id="Section1ï¼šé€è¦–å’Œè‡ªç„"><a href="#Section1ï¼šé€è¦–å’Œè‡ªç„" class="headerlink" title="Section1ï¼šé€è¦–å’Œè‡ªç„"></a>Section1ï¼šé€è¦–å’Œè‡ªç„</h2><p>UE4çš„å¤§é«”æ¡†æ¶å¦‚ä¸‹ï¼Œå¯¦ç¾é€è¦–ã€è‡ªç„æ‰€éœ€çš„è®Šé‡å¤§è‡´éƒ½åˆ—äº†å‡ºä¾†ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image63.png" alt="image.png"></p>
<p>åœ–ç‰‡ä¾†æºï¼š<a target="_blank" rel="noopener" href="https://renyili.org/post/game_cheat2/">https://renyili.org/post/game_cheat2/</a></p>
<h3 id="ç¹ªåœ–å‡½æ•¸"><a href="#ç¹ªåœ–å‡½æ•¸" class="headerlink" title="ç¹ªåœ–å‡½æ•¸"></a>ç¹ªåœ–å‡½æ•¸</h3><p>ç¹ªåœ–å‡½æ•¸ç”¨æ–¼è¼¸å‡ºé€è¦–çš„çµæœï¼Œ<code>K2_DrawLine</code>æ˜¯UE4è‡ªå¸¶çš„ç¹ªåœ–å‡½æ•¸ï¼Œæ˜¯<code>UCanvas</code>çš„æˆå“¡å‡½æ•¸ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image64.png" alt="image.png"></p>
<p>ç”¨ue4dumperå°‡éŠæˆ²æ‰€æœ‰å°è±¡dumpä¸‹ä¾†ï¼Œè¨˜ç‚º<code>Objects.txt</code>ï¼Œåœ¨å…¶ä¸­æœCanvasï¼Œçœ‹åˆ°æœ‰ä¸€å€‹<code>DebugCanvasObject</code>ã€‚</p>
<p>é€™ä»£è¡¨é€šéGObjectèƒ½éæ­·åˆ°è©²å°è±¡ï¼Œç„¶å¾Œå°±å¯ä»¥é€šéå®ƒä¾†èª¿ç”¨<code>K2_DrawLine</code>ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image65.png" alt="image.png"></p>
<p>åªèª¿ç”¨ä¸€æ¬¡<code>K2_DrawLine</code>ç¹ªåˆ¶çš„æ±è¥¿ç„¡æ³•é•·ä¹…ä¿ç•™åœ¨å±å¹•ä¸Šï¼Œå› æ­¤è¦åœ¨ä¸€å€‹åˆé©çš„æ™‚æ©Ÿä¸æ–·èª¿ç”¨<code>K2_DrawLine</code>ï¼Œé€™æ¨£ç¹ªåˆ¶çš„æ±è¥¿æ‰ä¸æœƒç«‹å³è¢«åˆ·èµ°ã€‚</p>
<p>åœ¨SDKè£¡çœ‹åˆ°<code>ReceiveDrawHUD</code>å‡½æ•¸ï¼Œhookå¾Œç™¼ç¾å®ƒæœƒä¸æ–·è¢«æŸè™•èª¿ç”¨ï¼Œå¤§æ¦‚æ¯æ¬¡ç¹ªè£½éŠæˆ²å±å¹•ä¸Šçš„ä¿¡æ¯æ™‚æœƒè§¸ç™¼ï¼Œåœ¨é€™æ™‚æ©Ÿèª¿ç”¨<code>K2_DrawLine</code>ç¹ªåˆ¶é€è¦–ä¿¡æ¯ç°¡ç›´å†åˆé©ä¸éã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image66.png" alt="image.png"></p>
<h3 id="ç¬¬ä¸€ç¨®é€è¦–æ€è·¯"><a href="#ç¬¬ä¸€ç¨®é€è¦–æ€è·¯" class="headerlink" title="ç¬¬ä¸€ç¨®é€è¦–æ€è·¯"></a>ç¬¬ä¸€ç¨®é€è¦–æ€è·¯</h3><p>åœ¨<code>Objects.txt</code>è£¡å¯ä»¥çœ‹åˆ°æœ‰å…©é¡çš„YellowBallï¼Œä¸€ç¨®æ˜¯æœƒå‹•çš„ï¼Œå¦ä¸€ç¨®æ˜¯å›ºå®šä¸å‹•çš„ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image67.png" alt="image.png"></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image68.png" alt="image.png"></p>
<p><code>Sphere4_Blueprint_C</code>é¡ä¸‹æœ‰<code>Speed</code>å±¬æ€§ï¼Œå› æ­¤å®ƒæ‡‰è©²å°±æ˜¯æœƒå‹•çš„YellowBallçš„é¡ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image69.png" alt="image.png"></p>
<p>ç„¡è«–å“ªä¸€ç¨®ï¼Œéƒ½ç¹¼æ‰¿æ–¼<code>AActor</code>ï¼Œè€Œ<code>AActor</code> â†’ <code>RootComponent</code> â†’ <code>RelativeLocation</code>è£¡ä¿å­˜è‘—åº§æ¨™ä¿¡æ¯( ä¸–ç•Œåº§æ¨™ )ã€‚</p>
<p>æ³¨ï¼šå±¬æ€§çš„Offsetå¯ä»¥åƒè€ƒSDKè£¡çš„ï¼Œè‹¥è¢«é­”æ”¹éå‰‡éœ€è¦ç”¨CEåˆ†æçœ‹çœ‹ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç²å–æŒ‡å®šactoråº§æ¨™</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getActorLocation</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">RootComponent</span> = <span class="title function_">ptr</span>(actor).<span class="title function_">add</span>(<span class="title class_">Offset</span>.<span class="property">AActorToRootComponent</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">RelativeLocation</span> = <span class="title class_">RootComponent</span>.<span class="title function_">add</span>(<span class="title class_">Offset</span>.<span class="property">USceneComponentToRelativeLocation</span>);</span><br><span class="line">    <span class="keyword">let</span> x = <span class="title class_">RelativeLocation</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> y = <span class="title class_">RelativeLocation</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> z = <span class="title class_">RelativeLocation</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;x&quot;</span>: x,</span><br><span class="line">        <span class="string">&quot;y&quot;</span>: y,</span><br><span class="line">        <span class="string">&quot;z&quot;</span>: z,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç²å–åˆ°ç›®æ¨™çš„ä¸–ç•Œåº§æ¨™å¾Œï¼Œè¦è½‰æ›ç‚ºå±å¹•åº§æ¨™ï¼Œç¬¬ä¸€ç¨®è½‰æ›æ–¹å¼æ˜¯å€ŸåŠ©UE4çš„é€è¦–æŠ•å½±çŸ©é™£ã€‚</p>
<p>æ³¨ï¼šé€è¦–æŠ•å½±ä½¿ç”¨é€è¦–çŸ©é™£å°‡3Då ´æ™¯ä¸­çš„ç‰©ä»¶è½‰æ›åˆ°2Då±å¹•åº§æ¨™ç³»ã€‚é€™å€‹çŸ©é™£æ˜¯é€éç›¸æ©Ÿä½ç½®å’Œæœå‘ä¿¡æ¯è¨ˆç®—å‡ºä¾†çš„ã€‚</p>
<p>é€™å€‹çŸ©é™£ä¿å­˜åœ¨<code>UCanvas</code>çš„<code>ViewProjectionMatrix</code>ï¼Œ<code>FMatrix</code>æ˜¯ä¸€å€‹4*4çš„çŸ©é™£ã€‚</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image70.png" alt="image.png"></p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image71.png" alt="image.png"></p>
<p>ç”¨fridaæˆ–ue4dumperç²å–<code>DebugCanvasObject</code>çš„åœ°å€( å‡è¨­æ˜¯0xc0402580 )ï¼Œç„¶å¾Œç”¨CEæŸ¥çœ‹å…¶å…§å­˜ï¼Œåˆ‡æ›ç‚ºfloaté¡å‹ä»¥ä¾¿è§€å¯Ÿã€‚</p>
<p>ç•¶éŠæˆ²é¡é ­è§’åº¦ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œç´…æ¡†çš„æ•¸æ“šä¹Ÿæœƒéš¨ä¹‹è®ŠåŒ–ï¼Œå› æ­¤é€™è£¡å¤§æ¦‚å°±æ˜¯<code>ViewProjectionMatrix</code>ï¼Œåç§»ç‚º0xC0402790 - 0xC0402580 = 0x210</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image72.png" alt="image.png"></p>
<p>çŸ¥é“äº†åç§»å¾Œï¼Œå°±èƒ½ç”¨fridaæå–<code>ViewProjectionMatrix</code>ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç²å–é€è¦–æŠ•å½±çŸ©é™£, ç”¨æ–¼è½‰æ›ä¸–ç•Œåº§æ¨™</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getViewProjectionMatrix</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">DebugCanvasObject</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">ViewProjectionMatrix</span> = <span class="title class_">DebugCanvasObject</span>.<span class="title function_">add</span>(<span class="title class_">Offset</span>.<span class="property">UCanvasToViewProjectionMatrix</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InX</span> = <span class="title class_">ViewProjectionMatrix</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InX</span>_x = <span class="title class_">InX</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InX</span>_y = <span class="title class_">InX</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InX</span>_z = <span class="title class_">InX</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InX</span>_tran = <span class="title class_">InX</span>.<span class="title function_">add</span>(<span class="number">3</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InY</span> = <span class="title class_">ViewProjectionMatrix</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InY</span>_x = <span class="title class_">InY</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InY</span>_y = <span class="title class_">InY</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InY</span>_z = <span class="title class_">InY</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InY</span>_tran = <span class="title class_">InY</span>.<span class="title function_">add</span>(<span class="number">3</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InZ</span> = <span class="title class_">ViewProjectionMatrix</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InZ</span>_x = <span class="title class_">InZ</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InZ</span>_y = <span class="title class_">InZ</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InZ</span>_z = <span class="title class_">InZ</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InZ</span>_tran = <span class="title class_">InZ</span>.<span class="title function_">add</span>(<span class="number">3</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InW</span> = <span class="title class_">ViewProjectionMatrix</span>.<span class="title function_">add</span>(<span class="number">3</span> * <span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InW</span>_x = <span class="title class_">InW</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InW</span>_y = <span class="title class_">InW</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InW</span>_z = <span class="title class_">InW</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">InW</span>_tran = <span class="title class_">InW</span>.<span class="title function_">add</span>(<span class="number">3</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        [<span class="title class_">InX</span>_x, <span class="title class_">InX</span>_y, <span class="title class_">InX</span>_z, <span class="title class_">InX</span>_tran],</span><br><span class="line">        [<span class="title class_">InY</span>_x, <span class="title class_">InY</span>_y, <span class="title class_">InY</span>_z, <span class="title class_">InY</span>_tran],</span><br><span class="line">        [<span class="title class_">InZ</span>_x, <span class="title class_">InZ</span>_y, <span class="title class_">InZ</span>_z, <span class="title class_">InZ</span>_tran],</span><br><span class="line">        [<span class="title class_">InW</span>_x, <span class="title class_">InW</span>_y, <span class="title class_">InW</span>_z, <span class="title class_">InW</span>_tran]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸–ç•Œåº§æ¨™ â†’ å±å¹•åº§æ¨™ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">W2S</span>(<span class="params">W</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> viewProjectionMatrix = <span class="title function_">getViewProjectionMatrix</span>();</span><br><span class="line">    <span class="keyword">if</span>(!viewProjectionMatrix)<span class="keyword">return</span> [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> res = [</span><br><span class="line">        viewProjectionMatrix[<span class="number">0</span>][<span class="number">0</span>] * W.<span class="property">x</span> + viewProjectionMatrix[<span class="number">1</span>][<span class="number">0</span>] * W.<span class="property">y</span> + viewProjectionMatrix[<span class="number">2</span>][<span class="number">0</span>] * W.<span class="property">z</span> + viewProjectionMatrix[<span class="number">3</span>][<span class="number">0</span>],</span><br><span class="line">        viewProjectionMatrix[<span class="number">0</span>][<span class="number">1</span>] * W.<span class="property">x</span> + viewProjectionMatrix[<span class="number">1</span>][<span class="number">1</span>] * W.<span class="property">y</span> + viewProjectionMatrix[<span class="number">2</span>][<span class="number">1</span>] * W.<span class="property">z</span> + viewProjectionMatrix[<span class="number">3</span>][<span class="number">1</span>],</span><br><span class="line">        viewProjectionMatrix[<span class="number">0</span>][<span class="number">2</span>] * W.<span class="property">x</span> + viewProjectionMatrix[<span class="number">1</span>][<span class="number">2</span>] * W.<span class="property">y</span> + viewProjectionMatrix[<span class="number">2</span>][<span class="number">2</span>] * W.<span class="property">z</span> + viewProjectionMatrix[<span class="number">3</span>][<span class="number">2</span>],</span><br><span class="line">        viewProjectionMatrix[<span class="number">0</span>][<span class="number">3</span>] * W.<span class="property">x</span> + viewProjectionMatrix[<span class="number">1</span>][<span class="number">3</span>] * W.<span class="property">y</span> + viewProjectionMatrix[<span class="number">2</span>][<span class="number">3</span>] * W.<span class="property">z</span> + viewProjectionMatrix[<span class="number">3</span>][<span class="number">3</span>],</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> r = res[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> rhw = <span class="number">1</span> / r;</span><br><span class="line">        <span class="keyword">let</span> inOutPosition = [];</span><br><span class="line">        inOutPosition[<span class="number">0</span>] = (((res[<span class="number">0</span>] * rhw) / <span class="number">2.0</span>) + <span class="number">0.5</span>) * <span class="number">1280</span>; <span class="comment">// 1280: é€šéDrawLineæ¸¬è©¦å‡ºä¾†çš„å¯¬åº¦</span></span><br><span class="line">        inOutPosition[<span class="number">1</span>] = (<span class="number">0.5</span> - ((res[<span class="number">1</span>] * rhw) / <span class="number">2.0</span>)) * <span class="number">760</span>;  <span class="comment">// 760 : é€šéDrawLineæ¸¬è©¦å‡ºä¾†çš„é«˜åº¦</span></span><br><span class="line">        inOutPosition[<span class="number">2</span>] = r;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inOutPosition;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒç¨®é€è¦–æ€è·¯"><a href="#ç¬¬äºŒç¨®é€è¦–æ€è·¯" class="headerlink" title="ç¬¬äºŒç¨®é€è¦–æ€è·¯"></a>ç¬¬äºŒç¨®é€è¦–æ€è·¯</h3><p>ç”¨UE4æœ¬èº«çš„å‡½æ•¸<code>ProjectWorldLocationToScreen</code>ä¾†å¯¦ç¾ä¸–ç•Œåº§æ¨™ â†’ å±å¹•åº§æ¨™ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬2ç¨®ï¼šä¸–ç•Œåº§æ¨™ -&gt; å±å¹•åº§æ¨™</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">W2S_2</span>(<span class="params">W</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">ProjectWorldLocationToScreen</span> = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(base.<span class="title function_">add</span>(<span class="number">0x39B8820</span>), <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> out = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(<span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> res = <span class="title class_">ProjectWorldLocationToScreen</span>(<span class="title class_">PlayerController</span>, W.<span class="property">x</span>, W.<span class="property">y</span>, W.<span class="property">z</span>, out, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        <span class="keyword">let</span> x = out.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">        <span class="keyword">let</span> y = out.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line">        <span class="keyword">let</span> z = out.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">readFloat</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [x, y, z]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™ç¨®æ–¹æ³•è½‰æ›å¾Œçš„åº§æ¨™é‚„éœ€é€²è¡Œä¸€äº›è™•ç†æ‰èƒ½ä½¿ç”¨ï¼Œå…·é«”è™•ç†åƒè€ƒï¼š<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0">https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0</a></p>
<h3 id="è‡ªç„æ€è·¯"><a href="#è‡ªç„æ€è·¯" class="headerlink" title="è‡ªç„æ€è·¯"></a>è‡ªç„æ€è·¯</h3><p>åŸç†ï¼šç²å–ç›®æ¨™åº§æ¨™èˆ‡æœ¬åœ°åº§æ¨™ï¼Œåˆ©ç”¨ä¸‰è§’å‡½æ•¸è¨ˆç®—å‡ºå…©è€…é–“çš„æ°´å¹³å¤¾è§’ã€å‚ç›´å¤¾è§’ï¼Œç„¶å¾Œè¨­ç½®äººç‰©ç›¸æ©Ÿçš„<code>ControlRotation</code>ç‚ºè©²å€¼å³å¯å¯¦ç¾è‡ªç„çš„æ•ˆæœã€‚</p>
<p>Playerå°è±¡ï¼š<code>PlayerController</code> â†’ <code>AcknowledgedPawn</code>( å®ƒä¹Ÿæ˜¯ç¹¼æ‰¿æ–¼AActor )ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPlayerLocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">PlayerController</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">AcknowledgedPawn</span> = <span class="title class_">PlayerController</span>.<span class="title function_">add</span>(<span class="title class_">Offset</span>.<span class="property">APlayerControllerToAcknowledgedPawn</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getActorLocation</span>(<span class="title class_">AcknowledgedPawn</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Playeræœå‘ä¿¡æ¯ï¼š<code>PlayerController</code> â†’ <code>ControlRotation</code>ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¨­ç½®ç›¸æ©Ÿ(äººç‰©)è§’åº¦ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setCameraRotation</span>(<span class="params">loc</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">ControlRotation</span> = <span class="title class_">PlayerController</span>.<span class="title function_">add</span>(<span class="title class_">Offset</span>.<span class="property">AControllerToControlRotation</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setCameraRotation:&quot;</span>, loc)</span><br><span class="line">    <span class="title class_">ControlRotation</span>.<span class="title function_">add</span>(<span class="number">0</span> * <span class="number">4</span>).<span class="title function_">writeFloat</span>(loc[<span class="number">0</span>])   <span class="comment">// å‚ç›´</span></span><br><span class="line">    <span class="title class_">ControlRotation</span>.<span class="title function_">add</span>(<span class="number">1</span> * <span class="number">4</span>).<span class="title function_">writeFloat</span>(loc[<span class="number">1</span>])   <span class="comment">// æ°´å¹³</span></span><br><span class="line">    <span class="title class_">ControlRotation</span>.<span class="title function_">add</span>(<span class="number">2</span> * <span class="number">4</span>).<span class="title function_">writeFloat</span>(loc[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>è‡ªç„å¯¦ç¾ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªç„å¯¦ç¾</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">aimbot</span>(<span class="params">targetLoc</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">calcTargetOffset</span>(<span class="params">targetLoc, cameraLoc</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> x = targetLoc.<span class="property">x</span> - cameraLoc.<span class="property">x</span>;</span><br><span class="line">        <span class="keyword">let</span> y = targetLoc.<span class="property">y</span> - cameraLoc.<span class="property">y</span>;</span><br><span class="line">        <span class="keyword">let</span> z = targetLoc.<span class="property">z</span> - cameraLoc.<span class="property">z</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> angleX = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> angleY = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; y == <span class="number">0</span>) angleX = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span>) angleX = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">atan</span>(y / x)) / <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span>) angleX = <span class="number">90</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span>) angleX = <span class="number">90</span> + <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">atan</span>(x / y)) / <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> &amp;&amp; y == <span class="number">0</span>) angleX = <span class="number">180</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> &amp;&amp; y &lt; <span class="number">0</span>) angleX = <span class="number">180</span> + <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">atan</span>(y / x)) / <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0</span> &amp;&amp; y &lt; <span class="number">0</span>) angleX = <span class="number">270</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; y &lt; <span class="number">0</span>) angleX = <span class="number">270</span> + <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Math</span>.<span class="title function_">atan</span>(x / y)) / <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (angleX &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            angleX += <span class="number">360</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (angleX &gt; <span class="number">360</span>) &#123;</span><br><span class="line">            angleX -= <span class="number">360</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        angleY = <span class="title class_">Math</span>.<span class="title function_">atan</span>(z / <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(x * x + y * y)) / <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (angleY &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            angleY += <span class="number">360</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [angleY, angleX, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">calcTargetOffset2</span>(<span class="params">targetLoc, cameraLoc</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> dx = targetLoc.<span class="property">x</span> - cameraLoc.<span class="property">x</span>;</span><br><span class="line">        <span class="keyword">let</span> dy = targetLoc.<span class="property">y</span> - cameraLoc.<span class="property">y</span>;</span><br><span class="line">        <span class="keyword">let</span> dz = targetLoc.<span class="property">z</span> - cameraLoc.<span class="property">z</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pi_2 = <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">let</span> pitch_range = <span class="number">90.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pitch = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(dz, <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(dx * dx + dy * dy)) * (pitch_range / pi_2);</span><br><span class="line">        <span class="keyword">if</span> (pitch &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            pitch += <span class="number">360</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> yaw_range = <span class="number">360</span>;</span><br><span class="line">        <span class="keyword">let</span> yaw = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(dy, dx) * yaw_range / <span class="number">4</span> / pi_2;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (yaw &lt; <span class="number">0.0</span>)&#123;</span><br><span class="line">            yaw += <span class="number">360.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [pitch, yaw, <span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> playerLoc = <span class="title function_">getPlayerLoccation</span>();</span><br><span class="line">    <span class="keyword">let</span> loc = <span class="title function_">calcTargetOffset2</span>(targetLoc, playerLoc);</span><br><span class="line">    <span class="title function_">setCameraRotation</span>(loc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœåœ–ï¼š</p>
<p><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/show2.gif" alt="show2.gif"></p>
<h2 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0">https://bbs.kanxue.com/thread-281464-1.htm#msg_header_h1_0</a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-281463.htm">https://bbs.kanxue.com/thread-281463.htm</a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-282857.htm">https://bbs.kanxue.com/thread-282857.htm</a></li>
<li><a target="_blank" rel="noopener" href="https://renyili.org/post/game_cheat2/">https://renyili.org/post/game_cheat2/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1930752-1-1.html">https://www.52pojie.cn/thread-1930752-1-1.html</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">NgIokWeng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é€£çµ: </span><span class="post-copyright-info"><a href="https://ngiokweng.github.io/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/">https://ngiokweng.github.io/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæ¬Šè²æ˜: </span><span class="post-copyright-info">æœ¬éƒ¨è½æ ¼æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥è²æ˜å¤–ï¼Œå‡æ¡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è¨±å¯å”è­°ã€‚è½‰è¼‰è«‹è¨»æ˜ä¾†è‡ª <a href="https://ngiokweng.github.io" target="_blank">NgIokWeng's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android%E9%80%86%E5%90%91/">Androidé€†å‘</a></div><div class="post_share"><div class="social-share" data-image="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image61.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/02/13/2025%E5%90%BE%E6%84%9B%E8%A7%A3%E9%A1%8C%E9%A0%98%E7%B4%85%E5%8C%85%E6%B4%BB%E5%8B%95(Android%E9%A1%8C%E8%A7%A3)/"><img class="prev-cover" src="/2025/02/13/2025%E5%90%BE%E6%84%9B%E8%A7%A3%E9%A1%8C%E9%A0%98%E7%B4%85%E5%8C%85%E6%B4%BB%E5%8B%95(Android%E9%A1%8C%E8%A7%A3)/image1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">2025å¾æ„›è§£é¡Œé ˜ç´…åŒ…æ´»å‹•(Androidé¡Œè§£)</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/03/%E6%9F%90%E7%9B%BEso%E5%8A%A0%E5%9B%BA%E8%88%87%E4%BF%AE%E5%BE%A9/"><img class="next-cover" src="/2025/01/03/%E6%9F%90%E7%9B%BEso%E5%8A%A0%E5%9B%BA%E8%88%87%E4%BF%AE%E5%BE%A9/1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æŸç›¾soåŠ å›ºèˆ‡ä¿®å¾©</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸é—œæ¨è–¦</span></div><div class="relatedPosts-list"><div><a href="/2024/05/26/B%E7%AB%99sign%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/" title="Bç«™signç®—æ³•åˆ†æ"><img class="cover" src="/2024/05/26/B%E7%AB%99sign%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/Untitled.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-26</div><div class="title">Bç«™signç®—æ³•åˆ†æ</div></div></a></div><div><a href="/2024/11/20/so%E5%8A%A0%E8%BC%89%E2%80%94relocate%E7%AF%87/" title="soåŠ è¼‰â€”relocateç¯‡"><img class="cover" src="/2024/11/20/so%E5%8A%A0%E8%BC%89%E2%80%94relocate%E7%AF%87/image1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-20</div><div class="title">soåŠ è¼‰â€”relocateç¯‡</div></div></a></div><div><a href="/2024/05/13/bilibili(Frida%E6%AA%A2%E6%B8%AC)/" title="bilibili(Fridaæª¢æ¸¬)"><img class="cover" src="/2024/05/13/bilibili(Frida%E6%AA%A2%E6%B8%AC)/Untitled.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-13</div><div class="title">bilibili(Fridaæª¢æ¸¬)</div></div></a></div><div><a href="/2024/05/27/ollvm_bcf_anti/" title="ollvm_bcf_anti"><img class="cover" src="/2024/05/27/ollvm_bcf_anti/Untitled.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-27</div><div class="title">ollvm_bcf_anti</div></div></a></div><div><a href="/2024/11/10/%E3%80%90N1CTF2024%E3%80%91ezapk/" title="ã€N1CTF2024ã€‘ezapk"><img class="cover" src="/2024/11/10/%E3%80%90N1CTF2024%E3%80%91ezapk/image1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-10</div><div class="title">ã€N1CTF2024ã€‘ezapk</div></div></a></div><div><a href="/2024/05/16/%E3%80%90Unity+lua%E6%89%8B%E9%81%8A%E9%80%86%E5%90%91%E3%80%91%E9%81%93%E5%8F%8B%E6%8E%9B%E6%A9%9F%E5%97%8E/" title="ã€Unity+luaæ‰‹éŠé€†å‘ã€‘é“å‹æ›æ©Ÿå—"><img class="cover" src="/2024/05/16/%E3%80%90Unity+lua%E6%89%8B%E9%81%8A%E9%80%86%E5%90%91%E3%80%91%E9%81%93%E5%8F%8B%E6%8E%9B%E6%A9%9F%E5%97%8E/Untitled.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-16</div><div class="title">ã€Unity+luaæ‰‹éŠé€†å‘ã€‘é“å‹æ›æ©Ÿå—</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è©•è«–</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/myImg/blogIcon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">NgIokWeng</div><div class="author-info__description">å¦‚æœä½ å°ç›®å‰æ“æœ‰çš„ä¸€åˆ‡è¦ºå¾—ä¸æ»¿ï¼Œç­‰åˆ°ä½ æ“æœ‰æ›´å¤šæ™‚ï¼Œä¹Ÿä¸è¦‹å¾—æœƒå¿«æ¨‚</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">51</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">æ¨™ç±¤</div><div class="length-num">20</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">åˆ†é¡</div><div class="length-num">9</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ngiokweng/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®éŒ„</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dump-SDK"><span class="toc-number">2.</span> <span class="toc-text">Dump SDK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UE4%E4%B8%89%E4%BB%B6%E5%A5%97"><span class="toc-number">2.1.</span> <span class="toc-text">UE4ä¸‰ä»¶å¥—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B5%90%E6%A7%8B%E4%BF%AE%E5%BE%A9"><span class="toc-number">2.2.</span> <span class="toc-text">çµæ§‹ä¿®å¾©</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A4%8E%E4%BF%9D%E8%AD%B7"><span class="toc-number">3.</span> <span class="toc-text">åŸºç¤ä¿è­·</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hook-svc"><span class="toc-number">3.1.</span> <span class="toc-text">hook svc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass%E6%80%9D%E8%B7%AF1"><span class="toc-number">3.2.</span> <span class="toc-text">bypassæ€è·¯1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass%E6%80%9D%E8%B7%AF2"><span class="toc-number">3.3.</span> <span class="toc-text">bypassæ€è·¯2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E8%A6%8B%E7%99%BB%E9%8C%84%E9%82%8F%E8%BC%AF"><span class="toc-number">4.</span> <span class="toc-text">åˆè¦‹ç™»éŒ„é‚è¼¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unicorn%E6%A8%A1%E6%93%AC%E5%9F%B7%E8%A1%8C%E8%A7%A3%E6%B7%B7%E6%B7%86"><span class="toc-number">5.</span> <span class="toc-text">Unicornæ¨¡æ“¬åŸ·è¡Œè§£æ··æ·†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%B7%B7%E6%B7%86%E6%80%9D%E8%B7%AF"><span class="toc-number">5.1.</span> <span class="toc-text">è§£æ··æ·†æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E4%B8%8D%E8%B6%B3%E4%B9%8B%E8%99%95"><span class="toc-number">5.2.</span> <span class="toc-text">ä¸€äº›ä¸è¶³ä¹‹è™•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section0%EF%BC%9A%E7%99%BB%E9%8C%84%E9%82%8F%E8%BC%AF%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">Section0ï¼šç™»éŒ„é‚è¼¯åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vm%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">6.1.</span> <span class="toc-text">vmåˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vm%E5%88%86%E6%9E%90"><span class="toc-number">6.2.</span> <span class="toc-text">vmåˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vm-handler%E5%88%86%E6%9E%90"><span class="toc-number">6.3.</span> <span class="toc-text">vm handleråˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vm%E6%8C%87%E4%BB%A4%E9%82%84%E5%8E%9F"><span class="toc-number">6.4.</span> <span class="toc-text">vmæŒ‡ä»¤é‚„åŸ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section0%EF%BC%9A%E7%99%BB%E9%8C%84%E7%AE%97%E6%B3%95%E9%82%84%E5%8E%9F"><span class="toc-number">7.</span> <span class="toc-text">Section0ï¼šç™»éŒ„ç®—æ³•é‚„åŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicorn%E8%BC%94%E5%8A%A9%E8%AA%BF%E8%A9%A6%E7%AE%97%E6%B3%95%E5%87%BA%E9%8C%AF%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">7.1.</span> <span class="toc-text">Unicornè¼”åŠ©èª¿è©¦ç®—æ³•å‡ºéŒ¯çš„åŸå› </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%8E%A8%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">åæ¨è§£å¯†ç®—æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section1%EF%BC%9A%E9%80%8F%E8%A6%96%E5%92%8C%E8%87%AA%E7%9E%84"><span class="toc-number">8.</span> <span class="toc-text">Section1ï¼šé€è¦–å’Œè‡ªç„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B9%AA%E5%9C%96%E5%87%BD%E6%95%B8"><span class="toc-number">8.1.</span> <span class="toc-text">ç¹ªåœ–å‡½æ•¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A8%AE%E9%80%8F%E8%A6%96%E6%80%9D%E8%B7%AF"><span class="toc-number">8.2.</span> <span class="toc-text">ç¬¬ä¸€ç¨®é€è¦–æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A8%AE%E9%80%8F%E8%A6%96%E6%80%9D%E8%B7%AF"><span class="toc-number">8.3.</span> <span class="toc-text">ç¬¬äºŒç¨®é€è¦–æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E7%9E%84%E6%80%9D%E8%B7%AF"><span class="toc-number">8.4.</span> <span class="toc-text">è‡ªç„æ€è·¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="toc-number">9.</span> <span class="toc-text">åƒè€ƒè³‡æ–™</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/03/18/%E8%A8%98%E4%B8%80%E6%AC%A1%E5%B0%8D%E6%9F%90%E9%9F%93%E9%81%8A%E7%9A%84%E5%8F%8D%E5%8F%8D%E8%AA%BF%E8%A9%A6/" title="è¨˜ä¸€æ¬¡å°æŸéŸ“éŠçš„ååèª¿è©¦"><img src="/2025/03/18/%E8%A8%98%E4%B8%80%E6%AC%A1%E5%B0%8D%E6%9F%90%E9%9F%93%E9%81%8A%E7%9A%84%E5%8F%8D%E5%8F%8D%E8%AA%BF%E8%A9%A6/image.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è¨˜ä¸€æ¬¡å°æŸéŸ“éŠçš„ååèª¿è©¦"/></a><div class="content"><a class="title" href="/2025/03/18/%E8%A8%98%E4%B8%80%E6%AC%A1%E5%B0%8D%E6%9F%90%E9%9F%93%E9%81%8A%E7%9A%84%E5%8F%8D%E5%8F%8D%E8%AA%BF%E8%A9%A6/" title="è¨˜ä¸€æ¬¡å°æŸéŸ“éŠçš„ååèª¿è©¦">è¨˜ä¸€æ¬¡å°æŸéŸ“éŠçš„ååèª¿è©¦</a><time datetime="2025-03-18T13:09:27.000Z" title="ç™¼è¡¨æ–¼ 2025-03-18 21:09:27">2025-03-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/13/2025%E5%90%BE%E6%84%9B%E8%A7%A3%E9%A1%8C%E9%A0%98%E7%B4%85%E5%8C%85%E6%B4%BB%E5%8B%95(Android%E9%A1%8C%E8%A7%A3)/" title="2025å¾æ„›è§£é¡Œé ˜ç´…åŒ…æ´»å‹•(Androidé¡Œè§£)"><img src="/2025/02/13/2025%E5%90%BE%E6%84%9B%E8%A7%A3%E9%A1%8C%E9%A0%98%E7%B4%85%E5%8C%85%E6%B4%BB%E5%8B%95(Android%E9%A1%8C%E8%A7%A3)/image1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2025å¾æ„›è§£é¡Œé ˜ç´…åŒ…æ´»å‹•(Androidé¡Œè§£)"/></a><div class="content"><a class="title" href="/2025/02/13/2025%E5%90%BE%E6%84%9B%E8%A7%A3%E9%A1%8C%E9%A0%98%E7%B4%85%E5%8C%85%E6%B4%BB%E5%8B%95(Android%E9%A1%8C%E8%A7%A3)/" title="2025å¾æ„›è§£é¡Œé ˜ç´…åŒ…æ´»å‹•(Androidé¡Œè§£)">2025å¾æ„›è§£é¡Œé ˜ç´…åŒ…æ´»å‹•(Androidé¡Œè§£)</a><time datetime="2025-02-13T01:20:48.000Z" title="ç™¼è¡¨æ–¼ 2025-02-13 09:20:48">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/" title="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)"><img src="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/image61.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)"/></a><div class="content"><a class="title" href="/2025/01/27/2024%E9%A8%B0%E8%A8%8A%E9%81%8A%E6%88%B2%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B3%BD%E5%AE%89%E5%8D%93%E6%B1%BA%E8%B3%BD(%E5%BE%A9%E7%8F%BE)/" title="2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)">2024é¨°è¨ŠéŠæˆ²å®‰å…¨å¤§è³½å®‰å“æ±ºè³½(å¾©ç¾)</a><time datetime="2025-01-27T09:00:58.000Z" title="ç™¼è¡¨æ–¼ 2025-01-27 17:00:58">2025-01-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/%E6%9F%90%E7%9B%BEso%E5%8A%A0%E5%9B%BA%E8%88%87%E4%BF%AE%E5%BE%A9/" title="æŸç›¾soåŠ å›ºèˆ‡ä¿®å¾©"><img src="/2025/01/03/%E6%9F%90%E7%9B%BEso%E5%8A%A0%E5%9B%BA%E8%88%87%E4%BF%AE%E5%BE%A9/1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æŸç›¾soåŠ å›ºèˆ‡ä¿®å¾©"/></a><div class="content"><a class="title" href="/2025/01/03/%E6%9F%90%E7%9B%BEso%E5%8A%A0%E5%9B%BA%E8%88%87%E4%BF%AE%E5%BE%A9/" title="æŸç›¾soåŠ å›ºèˆ‡ä¿®å¾©">æŸç›¾soåŠ å›ºèˆ‡ä¿®å¾©</a><time datetime="2025-01-03T15:37:36.000Z" title="ç™¼è¡¨æ–¼ 2025-01-03 23:37:36">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/28/LIAPP%E6%89%8B%E9%81%8A%E4%BF%9D%E8%AD%B7%E5%88%86%E6%9E%90/" title="LIAPPæ‰‹éŠä¿è­·åˆ†æ"><img src="/2024/11/28/LIAPP%E6%89%8B%E9%81%8A%E4%BF%9D%E8%AD%B7%E5%88%86%E6%9E%90/image1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LIAPPæ‰‹éŠä¿è­·åˆ†æ"/></a><div class="content"><a class="title" href="/2024/11/28/LIAPP%E6%89%8B%E9%81%8A%E4%BF%9D%E8%AD%B7%E5%88%86%E6%9E%90/" title="LIAPPæ‰‹éŠä¿è­·åˆ†æ">LIAPPæ‰‹éŠä¿è­·åˆ†æ</a><time datetime="2024-11-28T11:59:08.000Z" title="ç™¼è¡¨æ–¼ 2024-11-28 19:59:08">2024-11-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By NgIokWeng</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¡Œ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é–±è®€æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ·ºè‰²å’Œæ·±è‰²æ¨¡å¼è½‰æ›"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å–®æ¬„å’Œé›™æ¬„åˆ‡æ›"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è¨­å®š"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®éŒ„"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´é”è©•è«–"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é ‚éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '213c1281d4936c27991d',
      clientSecret: 'e52f4c4e54b9993a1226672a59463577a9fd73cd',
      repo: 'ngiokweng.github.io',
      owner: 'ngiokweng',
      admin: ['ngiokweng'],
      id: 'a5951d779c7620180a03ce6fcd96baec',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>